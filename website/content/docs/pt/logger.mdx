---
title: Logger
description: Sistema avan√ßado de logging com cores, √≠cones e timestamps
icon: Terminal
---

# Logger üìù

AzuraJS inclui um poderoso sistema de logging com suporte para cores, √≠cones, timestamps e personaliza√ß√£o completa.

## In√≠cio R√°pido üöÄ

```typescript
import { log } from 'azurajs/logger';

log.info('Servidor iniciado na porta 3000');
log.success('Tarefa conclu√≠da com sucesso');
log.warn('Uso de mem√≥ria est√° alto');
log.error('Falha na conex√£o');
```

## N√≠veis de Log üìä

### N√≠veis Dispon√≠veis

```typescript
log.debug('Informa√ß√£o de depura√ß√£o');    // üêõ Cinza
log.info('Mensagem informativa');        // ‚ÑπÔ∏è  Ciano
log.success('Mensagem de sucesso');      // ‚úÖ Verde Brilhante
log.warn('Mensagem de aviso');           // ‚ö†Ô∏è  Amarelo
log.error('Mensagem de erro');           // ‚ùå Vermelho
log.fatal('Erro fatal');                 // üíÄ Vermelho Brilhante
log.trace('Mensagem de rastreamento');   // üîç Magenta
log.log('Log geral');                    // üìù Branco
```

## Configura√ß√£o ‚öôÔ∏è

### Configura√ß√£o Global

Configure o logger globalmente para todas as chamadas subsequentes:

```typescript
import { configureLogger } from 'azurajs/logger';

configureLogger({
  showTimestamp: true,
  timestampFormat: 'datetime',
  showIcon: true,
  prefix: 'MeuApp',
  uppercase: true,
  bold: true
});

// Agora todos os logs usam esta configura√ß√£o
log.info('Servidor iniciado');  // [MeuApp:INFO] ‚ÑπÔ∏è 11/01/2026, 14:30:45 Servidor iniciado
```

### Configura√ß√£o Por Chamada

Sobrescreva a configura√ß√£o global para chamadas espec√≠ficas:

```typescript
log.info('Mensagem customizada', {
  showTimestamp: false,
  bold: true,
  colors: {
    info: '#00ff00'  // Cor verde personalizada
  }
});
```

## Op√ß√µes de Configura√ß√£o üé®

### Configura√ß√£o Completa

```typescript
interface LoggerConfig {
  // Mapeamento de cores personalizadas (hex, rgb ou predefinidas)
  colors?: Record<string, string>;
  
  // Mapeamento de √≠cones personalizados
  icons?: Record<string, string>;
  
  // Mostrar timestamps
  showTimestamp?: boolean;
  
  // Mostrar √≠cones
  showIcon?: boolean;
  
  // Formato de timestamp: 'time', 'datetime' ou 'iso'
  timestampFormat?: 'time' | 'datetime' | 'iso';
  
  // Prefixo personalizado (padr√£o: 'Azura')
  prefix?: string;
  
  // Exibir n√≠vel em mai√∫sculas
  uppercase?: boolean;
  
  // Aplicar estilo negrito
  bold?: boolean;
  
  // Aplicar estilo dim/desbotado
  dim?: boolean;
  
  // Cor de fundo
  backgroundColor?: string;
}
```

## Cores Personalizadas üé®

### Cores Hexadecimais

```typescript
log.info('Mensagem', {
  colors: {
    info: '#ff5733'  // Laranja personalizado
  }
});
```

### Cores RGB

```typescript
log.info('Mensagem', {
  colors: {
    info: 'rgb(255, 87, 51)'
  }
});
```

### Cores Predefinidas

```typescript
log.info('Mensagem', {
  colors: {
    info: 'brightBlue'  // Usar cor predefinida
  }
});
```

Cores dispon√≠veis:
- `black`, `red`, `green`, `yellow`, `blue`, `magenta`, `cyan`, `white`, `gray`
- `brightRed`, `brightGreen`, `brightYellow`, `brightBlue`, `brightMagenta`, `brightCyan`, `brightWhite`

## √çcones Personalizados üé≠

```typescript
log.info('Mensagem', {
  icons: {
    info: 'üöÄ'  // √çcone de foguete personalizado
  }
});

// Desabilitar √≠cones
log.info('Mensagem', {
  showIcon: false
});
```

## Timestamps ‚è∞

### Apenas Hora (HH:MM:SS)

```typescript
configureLogger({
  showTimestamp: true,
  timestampFormat: 'time'
});

log.info('Mensagem');  // 14:23:45 ‚ÑπÔ∏è [Azura:INFO] Mensagem
```

### Data e Hora Completa

```typescript
configureLogger({
  showTimestamp: true,
  timestampFormat: 'datetime'
});

log.info('Mensagem');  // 11/01/2026, 14:23:45 ‚ÑπÔ∏è [Azura:INFO] Mensagem
```

### ISO 8601

```typescript
configureLogger({
  showTimestamp: true,
  timestampFormat: 'iso'
});

log.info('Mensagem');  // 2026-01-11T14:23:45.123Z ‚ÑπÔ∏è [Azura:INFO] Mensagem
```

## Op√ß√µes de Estilo üíÖ

### Texto em Negrito

```typescript
log.info('Mensagem importante', { bold: true });
```

### Texto Desbotado

```typescript
log.trace('Menos importante', { dim: true });
```

### Cor de Fundo

```typescript
log.error('Erro cr√≠tico', {
  backgroundColor: 'bgRed'
});
```

### Estiliza√ß√£o Combinada

```typescript
log.success('Pronto!', {
  bold: true,
  colors: { success: '#00ff00' },
  backgroundColor: 'bgBlack'
});
```

## Uso Avan√ßado üéØ

### Prefixo Personalizado

```typescript
configureLogger({
  prefix: 'MinhaAPI'
});

log.info('Requisi√ß√£o recebida');  // [MinhaAPI:INFO] ‚ÑπÔ∏è Requisi√ß√£o recebida
```

### Diferentes Prefixos Por Servi√ßo

```typescript
const dbLogger = (msg: string) => log.info(msg, { prefix: 'Database' });
const apiLogger = (msg: string) => log.info(msg, { prefix: 'API' });

dbLogger('Conex√£o estabelecida');  // [Database:INFO] ‚ÑπÔ∏è Conex√£o estabelecida
apiLogger('Servidor iniciado');    // [API:INFO] ‚ÑπÔ∏è Servidor iniciado
```

### Usando a Fun√ß√£o Logger Bruta

```typescript
import { logger } from 'azurajs/logger';

logger('info', 'Log personalizado', {
  showTimestamp: true,
  colors: { info: '#00ff00' }
});
```

## Utilit√°rios de Cor üñåÔ∏è

Acesse fun√ß√µes de cor diretamente:

```typescript
import { colors } from 'azurajs/logger';

// Converter hex para ANSI
const greenAnsi = colors.hex('#00ff00');
console.log(`${greenAnsi}Texto verde${colors.reset}`);

// Converter RGB para ANSI
const blueAnsi = colors.rgb(0, 0, 255);
console.log(`${blueAnsi}Texto azul${colors.reset}`);

// Usar cores predefinidas
console.log(`${colors.ansi.brightRed}Texto vermelho${colors.reset}`);

// Cores de fundo
console.log(`${colors.bg.bgYellow}Fundo amarelo${colors.reset}`);

// Estiliza√ß√£o
console.log(`${colors.bold}Texto em negrito${colors.reset}`);
console.log(`${colors.dim}Texto desbotado${colors.reset}`);
```

## Exemplos Pr√°ticos üí°

### Logging de Requisi√ß√µes HTTP

```typescript
app.use((req, res, next) => {
  log.info(`${req.method} ${req.path}`, {
    showTimestamp: true,
    timestampFormat: 'time'
  });
  next();
});
```

### Rastreamento de Erros

```typescript
try {
  await operacaoArriscada();
  log.success('Opera√ß√£o conclu√≠da');
} catch (error) {
  log.error(`Opera√ß√£o falhou: ${error.message}`, {
    showTimestamp: true,
    bold: true
  });
}
```

### Desenvolvimento vs Produ√ß√£o

```typescript
const isDev = process.env.NODE_ENV === 'development';

configureLogger({
  showTimestamp: !isDev,
  showIcon: isDev,
  colors: isDev ? undefined : {
    info: 'white',
    error: 'red'
  }
});
```

### Logging Estruturado

```typescript
function logRequest(req: any) {
  log.info('Requisi√ß√£o', {
    prefix: 'API',
    showTimestamp: true
  });
  log.debug(JSON.stringify({
    method: req.method,
    path: req.path,
    ip: req.ip
  }, null, 2));
}
```

## Melhores Pr√°ticas üíé

1. **Configure globalmente uma vez** no in√≠cio da aplica√ß√£o
2. **Use n√≠veis apropriados** - n√£o use `error` para avisos
3. **Inclua timestamps em produ√ß√£o** para depura√ß√£o
4. **Desabilite cores em ambientes CI/CD**
5. **Use prefixos** para identificar fontes de log
6. **Mantenha mensagens concisas** mas informativas
7. **Desabilite logs de debug** em produ√ß√£o

## Guia de Migra√ß√£o üîÑ

### Do console.log

```typescript
// Antes
console.log('Servidor iniciado');
console.error('Ocorreu um erro');

// Depois
log.info('Servidor iniciado');
log.error('Ocorreu um erro');
```

### Do Winston/Pino

```typescript
// Antes (Winston)
logger.info('Mensagem', { timestamp: true });

// Depois (Azura)
log.info('Mensagem', { showTimestamp: true });
```

## Refer√™ncia da API üìñ

### Fun√ß√µes Principais

- `log.debug(msg, options?)` - Mensagem de debug
- `log.info(msg, options?)` - Mensagem informativa
- `log.success(msg, options?)` - Mensagem de sucesso
- `log.warn(msg, options?)` - Mensagem de aviso
- `log.error(msg, options?)` - Mensagem de erro
- `log.fatal(msg, options?)` - Mensagem de erro fatal
- `log.trace(msg, options?)` - Mensagem de rastreamento
- `log.log(msg, options?)` - Log geral

### Configura√ß√£o

- `configureLogger(config)` - Definir configura√ß√£o global
- `logger(level, msg, options?)` - Fun√ß√£o logger bruta
- `colors.*` - Utilit√°rios de cor

## Logging Estruturado üìã

Logging estruturado torna os logs leg√≠veis por m√°quina e mais f√°ceis de consultar:

```typescript
import { log } from 'azurajs/logger';

// Log estruturado b√°sico
log.info('Login de usu√°rio', {
  userId: '12345',
  email: 'usuario@example.com',
  ip: '192.168.1.1',
  userAgent: 'Mozilla/5.0...'
});

// Logging de requisi√ß√µes HTTP
function logRequest(req: Request) {
  log.info('Requisi√ß√£o HTTP', {
    method: req.method,
    path: req.url,
    ip: req.ip,
    userAgent: req.headers['user-agent'],
    timestamp: new Date().toISOString()
  });
}

// Erro com contexto
try {
  await processarPagamento(pedidoId);
} catch (error) {
  log.error('Falha no processamento do pagamento', {
    pedidoId,
    userId,
    valor,
    erro: error.message,
    stack: error.stack
  });
}

// M√©tricas de performance
log.info('Consulta ao banco de dados conclu√≠da', {
  query: 'SELECT * FROM users',
  duracao: '45ms',
  numeroLinhas: 150,
  cached: false
});
```

### Logging JSON para Produ√ß√£o

```typescript
class JSONLogger {
  log(level: string, message: string, context?: Record<string, any>) {
    const logEntry = {
      timestamp: new Date().toISOString(),
      level: level.toUpperCase(),
      message,
      ...context,
      environment: process.env.NODE_ENV,
      service: 'minha-api',
      version: '1.0.0'
    };
    
    console.log(JSON.stringify(logEntry));
  }
  
  info(message: string, context?: Record<string, any>) {
    this.log('info', message, context);
  }
  
  error(message: string, error: Error, context?: Record<string, any>) {
    this.log('error', message, {
      ...context,
      error: {
        message: error.message,
        stack: error.stack,
        name: error.name
      }
    });
  }
}

const logger = new JSONLogger();

// Uso
logger.info('Servidor iniciado', { port: 3000 });
// Sa√≠da: {"timestamp":"2026-01-13T10:30:00.000Z","level":"INFO","message":"Servidor iniciado","port":3000,"environment":"production","service":"minha-api","version":"1.0.0"}
```

## Logging de Request/Response üîÑ

### Middleware para Logging de Requisi√ß√µes

```typescript
import { log } from 'azurajs/logger';
import { performance } from 'perf_hooks';

function requestLogger(req: RequestServer, res: ResponseServer, next: () => void) {
  const start = performance.now();
  const requestId = crypto.randomUUID();
  
  // Log da requisi√ß√£o recebida
  log.info(`‚Üí ${req.method} ${req.url}`, {
    requestId,
    method: req.method,
    url: req.url,
    ip: req.ip,
    userAgent: req.headers['user-agent']
  });
  
  // Log da resposta
  res.on('finish', () => {
    const duration = performance.now() - start;
    const statusColor = res.statusCode < 400 ? 'success' : 'error';
    
    log[statusColor](`‚Üê ${req.method} ${req.url} ${res.statusCode}`, {
      requestId,
      method: req.method,
      url: req.url,
      statusCode: res.statusCode,
      duration: `${duration.toFixed(2)}ms`,
      contentLength: res.getHeader('content-length')
    });
  });
  
  next();
}

app.use(requestLogger);
```

### Logging Detalhado do Body (Desenvolvimento)

```typescript
function detailedRequestLogger(req: RequestServer, res: ResponseServer, next: () => void) {
  if (process.env.NODE_ENV === 'development') {
    log.debug('Detalhes da Requisi√ß√£o', {
      method: req.method,
      url: req.url,
      headers: req.headers,
      query: req.query,
      body: req.body,
      cookies: req.cookies
    });
  }
  next();
}
```

## Loggers Personalizados üé®

### Loggers Espec√≠ficos por Servi√ßo

```typescript
class ServiceLogger {
  constructor(private serviceName: string) {}
  
  log(level: string, message: string, context?: Record<string, any>) {
    log[level](`[${this.serviceName}] ${message}`, {
      service: this.serviceName,
      ...context
    });
  }
  
  info(message: string, context?: Record<string, any>) {
    this.log('info', message, context);
  }
  
  error(message: string, context?: Record<string, any>) {
    this.log('error', message, context);
  }
}

// Uso
const dbLogger = new ServiceLogger('Database');
const cacheLogger = new ServiceLogger('Cache');
const authLogger = new ServiceLogger('Auth');

dbLogger.info('Conex√£o estabelecida', { host: 'localhost', port: 5432 });
cacheLogger.info('Cache hit', { key: 'user:123', ttl: 3600 });
authLogger.error('Falha no login', { userId: '123', razao: 'Senha inv√°lida' });

// Sa√≠da:
// [Database] Conex√£o estabelecida
// [Cache] Cache hit
// [Auth] Falha no login
```

### Padr√£o Logger Factory

```typescript
class LoggerFactory {
  private static loggers = new Map<string, Logger>();
  
  static getLogger(name: string): Logger {
    if (!this.loggers.has(name)) {
      this.loggers.set(name, new Logger(name));
    }
    return this.loggers.get(name)!;
  }
}

class Logger {
  constructor(private name: string) {}
  
  info(message: string) {
    log.info(`[${this.name}] ${message}`);
  }
  
  error(message: string, error?: Error) {
    log.error(`[${this.name}] ${message}`, {
      error: error?.message,
      stack: error?.stack
    });
  }
}

// Uso
const userLogger = LoggerFactory.getLogger('UserService');
const orderLogger = LoggerFactory.getLogger('OrderService');

userLogger.info('Usu√°rio criado');
orderLogger.info('Pedido realizado');
```

## Estrat√©gias de Logging em Produ√ß√£o üè≠

### N√≠veis de Log por Ambiente

```typescript
const LOG_LEVELS = {
  development: 'debug',
  staging: 'info',
  production: 'warn'
};

const currentLogLevel = LOG_LEVELS[process.env.NODE_ENV || 'development'];

configureLogger({
  level: currentLogLevel
});
```

### Filtrar Dados Sens√≠veis

```typescript
const CAMPOS_SENSIVEIS = ['password', 'senha', 'token', 'apiKey', 'secret', 'creditCard', 'cartaoCredito'];

function sanitizarLog(data: any): any {
  if (typeof data !== 'object' || data === null) {
    return data;
  }
  
  const sanitizado = Array.isArray(data) ? [] : {};
  
  for (const [key, value] of Object.entries(data)) {
    if (CAMPOS_SENSIVEIS.some(field => key.toLowerCase().includes(field.toLowerCase()))) {
      sanitizado[key] = '***CENSURADO***';
    } else if (typeof value === 'object') {
      sanitizado[key] = sanitizarLog(value);
    } else {
      sanitizado[key] = value;
    }
  }
  
  return sanitizado;
}

// Uso
const dadosUsuario = {
  username: 'joao',
  senha: 'secret123',
  email: 'joao@example.com',
  apiKey: 'sk_live_xxxxx'
};

log.info('Dados do usu√°rio', sanitizarLog(dadosUsuario));
// Sa√≠da: { username: 'joao', senha: '***CENSURADO***', email: 'joao@example.com', apiKey: '***CENSURADO***' }
```

### Amostragem de Performance

Registre apenas uma amostra das requisi√ß√µes em ambientes de alto tr√°fego:

```typescript
function samplingLogger(sampleRate: number = 0.1) {
  return (req: RequestServer, res: ResponseServer, next: () => void) => {
    const shouldLog = Math.random() < sampleRate;
    
    if (shouldLog || res.statusCode >= 400) {  // Sempre loga erros
      log.info(`${req.method} ${req.url} ${res.statusCode}`);
    }
    
    next();
  };
}

// Loga 10% das requisi√ß√µes, mas sempre loga erros
app.use(samplingLogger(0.1));
```

## Rota√ß√£o de Logs üîÑ

### Rota√ß√£o de Logs Baseada em Arquivo

```bash
npm install rotating-file-stream
```

```typescript
import rfs from 'rotating-file-stream';
import { createWriteStream } from 'fs';
import { join } from 'path';

// Criar stream rotativo
const accessLogStream = rfs.createStream('access.log', {
  interval: '1d',    // Rotacionar diariamente
  maxFiles: 30,      // Manter 30 dias
  path: join(__dirname, 'logs'),
  compress: 'gzip'   // Comprimir logs antigos
});

const errorLogStream = rfs.createStream('error.log', {
  interval: '1d',
  maxFiles: 90,      // Manter erros por mais tempo
  path: join(__dirname, 'logs'),
  compress: 'gzip'
});

// Escrever logs em arquivos
class FileLogger {
  info(message: string, context?: any) {
    const logEntry = JSON.stringify({
      timestamp: new Date().toISOString(),
      level: 'INFO',
      message,
      ...context
    }) + '\n';
    
    accessLogStream.write(logEntry);
  }
  
  error(message: string, error?: Error, context?: any) {
    const logEntry = JSON.stringify({
      timestamp: new Date().toISOString(),
      level: 'ERROR',
      message,
      error: {
        message: error?.message,
        stack: error?.stack
      },
      ...context
    }) + '\n';
    
    errorLogStream.write(logEntry);
  }
}

const fileLogger = new FileLogger();
```

### Estrat√©gia de Limpeza de Logs

```typescript
import { unlink, readdir, stat } from 'fs/promises';
import { join } from 'path';

async function limparLogsAntigos(directory: string, maxAgeDays: number) {
  const files = await readdir(directory);
  const now = Date.now();
  const maxAge = maxAgeDays * 24 * 60 * 60 * 1000;
  
  for (const file of files) {
    const filePath = join(directory, file);
    const stats = await stat(filePath);
    const age = now - stats.mtime.getTime();
    
    if (age > maxAge) {
      await unlink(filePath);
      log.info(`Arquivo de log antigo deletado: ${file}`);
    }
  }
}

// Executar diariamente
setInterval(() => {
  limparLogsAntigos('./logs', 30);  // Deletar logs com mais de 30 dias
}, 24 * 60 * 60 * 1000);
```

## Integra√ß√£o com Winston/Pino üîå

### Integra√ß√£o com Winston

```bash
npm install winston
```

```typescript
import winston from 'winston';

const winstonLogger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    // Escrever todos os logs no console
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    // Escrever todos os logs em arquivo
    new winston.transports.File({ 
      filename: 'logs/error.log', 
      level: 'error' 
    }),
    new winston.transports.File({ 
      filename: 'logs/combined.log' 
    })
  ]
});

// Encapsular Winston com interface do logger AzuraJS
class WinstonWrapper {
  info(message: string, context?: any) {
    winstonLogger.info(message, context);
  }
  
  error(message: string, error?: Error) {
    winstonLogger.error(message, { error: error?.message, stack: error?.stack });
  }
  
  warn(message: string) {
    winstonLogger.warn(message);
  }
  
  debug(message: string) {
    winstonLogger.debug(message);
  }
}

export const logger = new WinstonWrapper();
```

### Integra√ß√£o com Pino

```bash
npm install pino pino-pretty
```

```typescript
import pino from 'pino';

const pinoLogger = pino({
  level: process.env.LOG_LEVEL || 'info',
  transport: process.env.NODE_ENV !== 'production' ? {
    target: 'pino-pretty',
    options: {
      colorize: true,
      translateTime: 'SYS:standard',
      ignore: 'pid,hostname'
    }
  } : undefined,
  formatters: {
    level: (label) => {
      return { level: label.toUpperCase() };
    }
  }
});

// Uso
pinoLogger.info('Servidor iniciado');
pinoLogger.error({ err: error }, 'Requisi√ß√£o falhou');
pinoLogger.debug({ userId: '123' }, 'Usu√°rio autenticado');
```

## Monitoramento & Alertas üîî

### Agrega√ß√£o de Erros

```typescript
class ErrorAggregator {
  private errors = new Map<string, {count: number, lastSeen: Date, samples: Error[]}>();
  
  track(error: Error) {
    const key = `${error.name}:${error.message}`;
    const existing = this.errors.get(key);
    
    if (existing) {
      existing.count++;
      existing.lastSeen = new Date();
      if (existing.samples.length < 5) {
        existing.samples.push(error);
      }
    } else {
      this.errors.set(key, {
        count: 1,
        lastSeen: new Date(),
        samples: [error]
      });
    }
    
    // Alertar se o erro ocorre com muita frequ√™ncia
    if (existing && existing.count > 10) {
      this.sendAlert(key, existing);
    }
  }
  
  private sendAlert(errorKey: string, data: any) {
    log.fatal(`üö® Alta taxa de erro detectada: ${errorKey}`, {
      count: data.count,
      lastSeen: data.lastSeen,
      sample: data.samples[0].stack
    });
    
    // Enviar para servi√ßo de monitoramento (ex: Sentry, DataDog)
  }
  
  getReport() {
    return Array.from(this.errors.entries()).map(([key, data]) => ({
      error: key,
      count: data.count,
      lastSeen: data.lastSeen
    }));
  }
}

const errorAggregator = new ErrorAggregator();

// Uso no manipulador de erros
app.use((error: Error, req, res, next) => {
  errorAggregator.track(error);
  log.error(error.message, { stack: error.stack });
  res.status(500).json({ error: 'Erro interno do servidor' });
});
```

### Logging de M√©tricas

```typescript
class MetricsLogger {
  private metrics = {
    requests: 0,
    errors: 0,
    avgResponseTime: 0,
    responseTimes: [] as number[]
  };
  
  logRequest(duration: number, statusCode: number) {
    this.metrics.requests++;
    this.metrics.responseTimes.push(duration);
    
    if (statusCode >= 400) {
      this.metrics.errors++;
    }
    
    // Calcular m√©dia
    this.metrics.avgResponseTime = 
      this.metrics.responseTimes.reduce((a, b) => a + b, 0) / 
      this.metrics.responseTimes.length;
    
    // Manter apenas as √∫ltimas 1000 entradas
    if (this.metrics.responseTimes.length > 1000) {
      this.metrics.responseTimes.shift();
    }
  }
  
  logMetrics() {
    log.info('M√©tricas de Performance', {
      totalRequests: this.metrics.requests,
      errors: this.metrics.errors,
      errorRate: `${(this.metrics.errors / this.metrics.requests * 100).toFixed(2)}%`,
      avgResponseTime: `${this.metrics.avgResponseTime.toFixed(2)}ms`,
      p95ResponseTime: this.calculatePercentile(95)
    });
  }
  
  private calculatePercentile(percentile: number): string {
    const sorted = [...this.metrics.responseTimes].sort((a, b) => a - b);
    const index = Math.ceil(sorted.length * (percentile / 100)) - 1;
    return `${sorted[index]?.toFixed(2) || 0}ms`;
  }
}

const metricsLogger = new MetricsLogger();

// Registrar m√©tricas a cada minuto
setInterval(() => {
  metricsLogger.logMetrics();
}, 60000);
```

## Considera√ß√µes de Performance ‚ö°

### Logging Ass√≠ncrono

```typescript
class AsyncLogger {
  private queue: Array<() => void> = [];
  private processing = false;
  
  log(message: string) {
    this.queue.push(() => {
      console.log(message);  // ou escrever em arquivo
    });
    
    if (!this.processing) {
      this.processQueue();
    }
  }
  
  private async processQueue() {
    this.processing = true;
    
    while (this.queue.length > 0) {
      const logFn = this.queue.shift();
      logFn?.();
      
      // Ceder ao event loop
      await new Promise(resolve => setImmediate(resolve));
    }
    
    this.processing = false;
  }
}
```

### Logging Condicional

```typescript
const isDevelopment = process.env.NODE_ENV === 'development';

// Apenas loga debug em desenvolvimento
if (isDevelopment) {
  log.debug('Informa√ß√£o detalhada de debug');
}

// Avalia√ß√£o pregui√ßosa
log.debug(() => {
  // Esta opera√ß√£o custosa s√≥ √© executada se o log de debug estiver habilitado
  return `Dados de debug: ${JSON.stringify(operacaoCustosa())}`;
});
```

### Logging em Lote

```typescript
class BatchLogger {
  private batch: any[] = [];
  private batchSize = 100;
  private flushInterval = 5000;
  
  constructor() {
    setInterval(() => this.flush(), this.flushInterval);
  }
  
  log(entry: any) {
    this.batch.push(entry);
    
    if (this.batch.length >= this.batchSize) {
      this.flush();
    }
  }
  
  private flush() {
    if (this.batch.length === 0) return;
    
    // Escrever todos os logs de uma vez
    console.log(JSON.stringify(this.batch));
    
    // Ou enviar para servi√ßo de logging
    // await sendToLoggingService(this.batch);
    
    this.batch = [];
  }
}

const batchLogger = new BatchLogger();
```

## Melhores Pr√°ticas üíé

### 1. Use N√≠veis de Log Apropriados

```typescript
// ‚ùå Ruim
log.error('Usu√°rio fez login');  // Isso n√£o √© um erro!

// ‚úÖ Bom
log.info('Usu√°rio fez login');
log.debug('Sess√£o criada');
log.warn('Uso alto de mem√≥ria detectado');
log.error('Falha na conex√£o com banco de dados');
log.fatal('Aplica√ß√£o n√£o pode iniciar');
```

### 2. Inclua Contexto

```typescript
// ‚ùå Ruim
log.error('Requisi√ß√£o falhou');

// ‚úÖ Bom
log.error('Requisi√ß√£o falhou', {
  endpoint: '/api/users',
  method: 'POST',
  statusCode: 500,
  error: error.message,
  userId: req.user?.id
});
```

### 3. N√£o Registre Dados Sens√≠veis

```typescript
// ‚ùå Ruim
log.info('Usu√°rio autenticado', { 
  password: user.password,  // Nunca logue senhas!
  creditCard: user.creditCard  // Nunca logue cart√µes de cr√©dito!
});

// ‚úÖ Bom
log.info('Usu√°rio autenticado', {
  userId: user.id,
  username: user.username,
  loginMethod: 'password'
});
```

### 4. Use Logging Estruturado em Produ√ß√£o

```typescript
// ‚úÖ Produ√ß√£o
if (process.env.NODE_ENV === 'production') {
  const logEntry = {
    timestamp: new Date().toISOString(),
    level: 'INFO',
    message: 'Requisi√ß√£o processada',
    requestId: req.id,
    duration: '45ms'
  };
  console.log(JSON.stringify(logEntry));
}

// ‚úÖ Desenvolvimento
if (process.env.NODE_ENV === 'development') {
  log.info('Requisi√ß√£o processada', {
    requestId: req.id,
    duration: '45ms'
  });
}
```

### 5. Registre em Pontos Estrat√©gicos

```typescript
// ‚úÖ Bons pontos de logging
class UserService {
  async createUser(data: UserData) {
    log.debug('Criando usu√°rio', { email: data.email });
    
    try {
      const user = await db.user.create(data);
      log.info('Usu√°rio criado com sucesso', { userId: user.id });
      return user;
    } catch (error) {
      log.error('Falha na cria√ß√£o do usu√°rio', {
        email: data.email,
        error: error.message
      });
      throw error;
    }
  }
}
```

### 6. Monitore o Volume de Logs

```typescript
let logCount = 0;
const LOG_THRESHOLD = 10000;

function monitoredLog(message: string) {
  logCount++;
  
  if (logCount > LOG_THRESHOLD) {
    log.warn(`Alto volume de logs detectado: ${logCount} logs`);
    // Talvez reduzir o n√≠vel de log ou investigar
  }
  
  log.info(message);
}

// Resetar contador a cada hora
setInterval(() => {
  logCount = 0;
}, 3600000);
```

### 7. Use IDs de Requisi√ß√£o para Rastreamento

```typescript
import { randomUUID } from 'crypto';

app.use((req, res, next) => {
  req.id = randomUUID();
  
  // Registrar todas as opera√ß√µes com ID de requisi√ß√£o
  req.log = {
    info: (msg: string, context?: any) => {
      log.info(msg, { requestId: req.id, ...context });
    },
    error: (msg: string, error?: Error) => {
      log.error(msg, { requestId: req.id, error: error?.message });
    }
  };
  
  next();
});

// Uso nos manipuladores
app.get('/api/users', (req, res) => {
  req.log.info('Buscando usu√°rios');
  // ...
});
```

## Solu√ß√£o de Problemas üîç

### Logs N√£o Aparecem

**Problema:** Logs n√£o aparecem no console

**Solu√ß√µes:**

1. Verifique o n√≠vel de log:
```typescript
configureLogger({ level: 'debug' });  // Mostrar todos os logs
```

2. Certifique-se de que o logging est√° habilitado:
```typescript
logging: {
  enabled: true  // Deve ser true
}
```

3. Verifique o ambiente:
```typescript
console.log('NODE_ENV:', process.env.NODE_ENV);
// Produ√ß√£o pode ter logging desabilitado
```

### Muitos Logs

**Problema:** Console inundado com logs

**Solu√ß√µes:**

1. Aumente o n√≠vel de log:
```typescript
configureLogger({ level: 'warn' });  // Apenas avisos e erros
```

2. Use amostragem:
```typescript
if (Math.random() < 0.1) {  // Registrar apenas 10%
  log.debug('Informa√ß√£o de debug');
}
```

3. Desabilite logs de debug em produ√ß√£o:
```typescript
logging: {
  level: process.env.NODE_ENV === 'production' ? 'error' : 'debug'
}
```

### Arquivos de Log Crescendo Demais

**Problema:** Arquivos de log consumindo muito espa√ßo em disco

**Solu√ß√µes:**

1. Implemente rota√ß√£o de logs (veja se√ß√£o Rota√ß√£o de Logs)
2. Comprima logs antigos
3. Configure limpeza automatizada
4. Use servi√ßo de logging externo (CloudWatch, DataDog)

### Impacto na Performance

**Problema:** Logging deixando a aplica√ß√£o lenta

**Solu√ß√µes:**

1. Use logging ass√≠ncrono (veja Considera√ß√µes de Performance)
2. Reduza a frequ√™ncia de logs
3. Fa√ßa amostragem de logs de alto volume
4. Use logging estruturado com servi√ßo externo

## Exemplos üìö

### Logger Completo para Produ√ß√£o

```typescript
import { log, configureLogger } from 'azurajs/logger';
import winston from 'winston';

class ProductionLogger {
  private winston: winston.Logger;
  
  constructor() {
    // Configurar Winston para logging em arquivo
    this.winston = winston.createLogger({
      level: 'info',
      format: winston.format.json(),
      transports: [
        new winston.transports.File({ filename: 'error.log', level: 'error' }),
        new winston.transports.File({ filename: 'combined.log' })
      ]
    });
    
    // Configurar logger do AzuraJS
    configureLogger({
      showTimestamp: true,
      timestampFormat: 'iso',
      level: 'error'  // Apenas erros em produ√ß√£o
    });
  }
  
  info(message: string, context?: any) {
    this.winston.info(message, context);
    if (process.env.VERBOSE === 'true') {
      log.info(message, context);
    }
  }
  
  error(message: string, error: Error, context?: any) {
    this.winston.error(message, {
      error: error.message,
      stack: error.stack,
      ...context
    });
    log.error(message, context);
  }
  
  warn(message: string, context?: any) {
    this.winston.warn(message, context);
    log.warn(message, context);
  }
}

export const logger = new ProductionLogger();
```

## Pr√≥ximos Passos üìñ

<Cards>
  <Card title="Configura√ß√£o" href="/docs/pt/configuration" description="Configure sua aplica√ß√£o" />
  <Card title="Error Handling" href="/docs/pt/error-handling" description="Tratamento eficaz de erros" />
  <Card title="Performance" href="/docs/pt/performance" description="Otimize sua aplica√ß√£o" />
  <Card title="Monitoramento" href="/docs/pt/monitoring" description="Monitore sua aplica√ß√£o" />
</Cards>
