---
title: Configuration
description: Complete guide to configuring your AzuraJS application
icon: Settings
---

# Configuration ‚öôÔ∏è

AzuraJS provides a powerful, flexible configuration system supporting TypeScript, JSON, and YAML formats with environment variable integration, hot reloading, and validation.

## Table of Contents

- [Quick Start](#quick-start)
- [Configuration Options Reference](#configuration-options-reference)
- [Environment-Specific Configs](#environment-specific-configs)
- [Environment Variables Integration](#environment-variables-integration)
- [Configuration Hierarchy](#configuration-hierarchy)
- [TypeScript Configuration](#typescript-configuration)
- [YAML/JSON Alternatives](#yamljson-alternatives)
- [Configuration Validation](#configuration-validation)
- [Hot Reload](#hot-reload)
- [Secrets Management](#secrets-management)
- [Best Practices](#best-practices)
- [Troubleshooting](#troubleshooting)

## Quick Start üöÄ

Create an `azura.config.ts` file in your project root:

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "development",
  server: {
    port: 3000,
    cluster: false,
    ipHost: true,
    https: false,
  },
  logging: {
    enabled: true,
    showDetails: true,
  },
  plugins: {
    cors: {
      enabled: true,
      origins: ["*"],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: ["Content-Type", "Authorization"],
    },
    rateLimit: {
      enabled: false,
      limit: 100,
      timeframe: 60000,
    },
  },
};

export default config;
```

## Configuration Options Reference üìã

### Complete Configuration Table

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `environment` | `"development"` \| `"production"` \| `"test"` \| `"staging"` | `"development"` | Application environment mode |
| `server.port` | `number` | `3000` | Server port number |
| `server.cluster` | `boolean` | `false` | Enable multi-core clustering |
| `server.ipHost` | `boolean` | `false` | Display local IP on startup |
| `server.https` | `boolean` | `false` | HTTPS protocol flag |
| `server.host` | `string` | `"0.0.0.0"` | Server bind host |
| `server.workers` | `number` | `os.cpus().length` | Number of cluster workers |
| `logging.enabled` | `boolean` | `true` | Enable request logging |
| `logging.showDetails` | `boolean` | `true` | Show detailed logs |
| `logging.level` | `"trace"` \| `"debug"` \| `"info"` \| `"warn"` \| `"error"` | `"info"` | Minimum log level |
| `plugins.cors.enabled` | `boolean` | `false` | Enable CORS plugin |
| `plugins.cors.origins` | `string` \| `string[]` | `[]` | Allowed origins |
| `plugins.cors.methods` | `string[]` | `["GET", "POST"]` | Allowed HTTP methods |
| `plugins.cors.allowedHeaders` | `string[]` | `[]` | Allowed request headers |
| `plugins.cors.credentials` | `boolean` | `false` | Allow credentials |
| `plugins.cors.maxAge` | `number` | `86400` | Preflight cache duration (seconds) |
| `plugins.rateLimit.enabled` | `boolean` | `false` | Enable rate limiting |
| `plugins.rateLimit.limit` | `number` | `100` | Requests per timeframe |
| `plugins.rateLimit.timeframe` | `number` | `60000` | Time window in milliseconds |
| `plugins.rateLimit.message` | `string` | `"Too Many Requests"` | Rate limit error message |

### Environment Configuration

The `environment` setting affects application behavior:

```typescript
environment: "development" | "production" | "test" | "staging"
```

**Effects by environment:**

| Feature | Development | Production | Test | Staging |
|---------|-------------|------------|------|---------|
| Detailed Logs | ‚úÖ Enabled | ‚ùå Disabled | ‚úÖ Enabled | ‚ö†Ô∏è Minimal |
| Stack Traces | ‚úÖ Full | ‚ùå Hidden | ‚úÖ Full | ‚ö†Ô∏è Sanitized |
| Hot Reload | ‚úÖ Enabled | ‚ùå Disabled | ‚ùå Disabled | ‚ùå Disabled |
| Clustering | ‚ö†Ô∏è Optional | ‚úÖ Recommended | ‚ùå Disabled | ‚úÖ Recommended |
| Debug Output | ‚úÖ Verbose | ‚ùå Silent | ‚úÖ Verbose | ‚ö†Ô∏è Warnings Only |

<Callout type="info">
  Production mode automatically optimizes performance by disabling detailed logging and enabling efficient error handling.
</Callout>

### Server Configuration

#### Port

```typescript
server: {
  port: 8080
}
```

**Environment variable override:**
```bash
PORT=8080 npm start
```

**Dynamic port selection:**
```typescript
server: {
  port: process.env.PORT ? parseInt(process.env.PORT) : 3000
}
```

#### Cluster Mode

Enable cluster mode to utilize all CPU cores:

```typescript
server: {
  cluster: true,
  workers: 4  // Optional: specify worker count
}
```

**Performance gains:**
- 4 cores: ~3.5x throughput
- 8 cores: ~7x throughput  
- 16 cores: ~14x throughput

<Callout type="warn">
  Cluster mode spawns multiple processes. Ensure your application is stateless or uses shared storage (Redis, database) for session data.
</Callout>

#### Custom Worker Count

```typescript
import os from "os";

const config: ConfigTypes = {
  server: {
    cluster: true,
    workers: Math.max(2, os.cpus().length - 1)  // Leave 1 core free
  }
};
```

#### IP Host Display

```typescript
server: {
  ipHost: true  // Shows: http://192.168.1.100:3000 on startup
}
```

Useful for mobile development and LAN testing.

#### HTTPS Configuration

```typescript
server: {
  https: true  // Affects req.protocol property
}
```

When behind a reverse proxy (nginx, Apache) with HTTPS termination.

#### Host Binding

```typescript
server: {
  host: "127.0.0.1"  // Localhost only
  // host: "0.0.0.0"  // All network interfaces (default)
}
```

### Logging Configuration üìù

#### Basic Logging

```typescript
logging: {
  enabled: true,
  showDetails: true
}
```

**Output example:**
```
‚Üí POST /api/users 201 Created (15ms)
‚Üí GET /api/posts 200 OK (8ms)
‚Üí DELETE /api/posts/123 204 No Content (12ms)
```

#### Log Levels

```typescript
logging: {
  enabled: true,
  level: "info"  // Only log "info" and above (warn, error)
}
```

**Level hierarchy:**
```
trace < debug < info < warn < error < fatal
```

#### Conditional Logging

```typescript
logging: {
  enabled: true,
  showDetails: process.env.NODE_ENV !== "production"
}
```

### CORS Plugin üåê

Complete CORS configuration:

```typescript
plugins: {
  cors: {
    enabled: true,
    origins: [
      "https://example.com",
      "https://app.example.com"
    ],
    methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
    allowedHeaders: [
      "Content-Type",
      "Authorization",
      "X-API-Key",
      "X-Requested-With"
    ],
    credentials: true,  // Allow cookies
    maxAge: 86400  // 24 hours preflight cache
  }
}
```

**Wildcard for development:**
```typescript
cors: {
  enabled: true,
  origins: process.env.NODE_ENV === "production" 
    ? ["https://yourdomain.com"]
    : ["*"]  // Allow all in development
}
```

**Multiple domain patterns:**
```typescript
cors: {
  enabled: true,
  origins: [
    "https://example.com",
    "https://*.example.com",  // All subdomains
    /^https:\/\/.*\.example\.com$/  // Regex pattern
  ]
}
```

### Rate Limiting Plugin üõ°Ô∏è

Protect your API from abuse:

```typescript
plugins: {
  rateLimit: {
    enabled: true,
    limit: 100,  // Requests
    timeframe: 60000,  // Per minute
    message: "Rate limit exceeded. Please try again later."
  }
}
```

**Different limits by endpoint:**
```typescript
// Global default
rateLimit: {
  enabled: true,
  limit: 100,
  timeframe: 60000
}

// Override in routes
app.get("/api/search", rateLimitMiddleware(500, 60000), handler);  // 500/min
app.post("/api/login", rateLimitMiddleware(5, 900000), handler);   // 5/15min
```

**Tiered rate limiting:**
```typescript
const limits = {
  free: { limit: 100, timeframe: 3600000 },      // 100/hour
  basic: { limit: 1000, timeframe: 3600000 },    // 1000/hour
  premium: { limit: 10000, timeframe: 3600000 }  // 10000/hour
};

rateLimit: {
  enabled: true,
  ...limits[userTier]
}
```

## Environment-Specific Configs üåç

### Development Configuration

```typescript title="azura.config.development.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "development",
  server: {
    port: 3000,
    cluster: false,  // Single process for debugging
    ipHost: true,    // Show LAN IP
    https: false,
  },
  logging: {
    enabled: true,
    showDetails: true,  // Verbose logging
    level: "debug"
  },
  plugins: {
    cors: {
      enabled: true,
      origins: ["*"],  // Allow all for testing
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
      allowedHeaders: ["*"]
    },
    rateLimit: {
      enabled: false  // No limits in dev
    }
  }
};

export default config;
```

### Staging Configuration

```typescript title="azura.config.staging.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "staging",
  server: {
    port: 8080,
    cluster: true,
    workers: 2,  // Limited cluster for cost savings
    ipHost: false,
    https: true,
  },
  logging: {
    enabled: true,
    showDetails: false,  // Minimal logging
    level: "warn"  // Only warnings and errors
  },
  plugins: {
    cors: {
      enabled: true,
      origins: [
        "https://staging.yourdomain.com",
        "https://test.yourdomain.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: ["Content-Type", "Authorization"],
      credentials: true
    },
    rateLimit: {
      enabled: true,
      limit: 500,  // Moderate limits
      timeframe: 60000
    }
  }
};

export default config;
```

### Production Configuration

```typescript title="azura.config.production.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "production",
  server: {
    port: 443,
    cluster: true,  // Full clustering
    workers: undefined,  // Use all available cores
    ipHost: false,
    https: true,
  },
  logging: {
    enabled: true,
    showDetails: false,  // Security: hide details
    level: "error"  // Only errors
  },
  plugins: {
    cors: {
      enabled: true,
      origins: [
        "https://yourdomain.com",
        "https://www.yourdomain.com",
        "https://app.yourdomain.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: ["Content-Type", "Authorization", "X-API-Key"],
      credentials: true,
      maxAge: 86400
    },
    rateLimit: {
      enabled: true,
      limit: 1000,  // Strict limits
      timeframe: 60000,
      message: "Too many requests"
    }
  }
};

export default config;
```

## Environment Variables Integration üîê

### Basic Environment Variables

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: (process.env.NODE_ENV as any) || "development",
  server: {
    port: parseInt(process.env.PORT || "3000"),
    cluster: process.env.CLUSTER === "true",
    https: process.env.HTTPS === "true",
  },
  logging: {
    enabled: process.env.LOGGING !== "false",
    showDetails: process.env.LOG_DETAILS === "true",
    level: (process.env.LOG_LEVEL as any) || "info"
  }
};

export default config;
```

### .env File Support

Install dotenv:
```bash
npm install dotenv
```

```bash title=".env"
NODE_ENV=production
PORT=8080
CLUSTER=true
HTTPS=true

# Logging
LOGGING=true
LOG_DETAILS=false
LOG_LEVEL=error

# CORS
CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# Rate Limiting
RATE_LIMIT=1000
RATE_TIMEFRAME=60000

# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/mydb
DATABASE_POOL_SIZE=20

# Redis
REDIS_URL=redis://localhost:6379

# API Keys
API_KEY=your-secret-api-key
JWT_SECRET=your-jwt-secret
```

```typescript title="azura.config.ts"
import "dotenv/config";
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: process.env.NODE_ENV as any,
  server: {
    port: parseInt(process.env.PORT!),
    cluster: process.env.CLUSTER === "true",
    https: process.env.HTTPS === "true",
  },
  logging: {
    enabled: process.env.LOGGING === "true",
    showDetails: process.env.LOG_DETAILS === "true",
    level: process.env.LOG_LEVEL as any
  },
  plugins: {
    cors: {
      enabled: true,
      origins: process.env.CORS_ORIGINS?.split(",") || []
    },
    rateLimit: {
      enabled: true,
      limit: parseInt(process.env.RATE_LIMIT!),
      timeframe: parseInt(process.env.RATE_TIMEFRAME!)
    }
  }
};

export default config;
```

### Environment-Specific .env Files

```
.env                 # Default
.env.development     # Development overrides
.env.staging         # Staging overrides
.env.production      # Production overrides
.env.local           # Local overrides (gitignored)
```

```typescript
import { config as dotenvConfig } from "dotenv";
import { resolve } from "path";

// Load environment-specific .env file
const env = process.env.NODE_ENV || "development";
dotenvConfig({ path: resolve(process.cwd(), `.env.${env}`) });

// Fallback to default .env
dotenvConfig();
```

## Configuration Hierarchy üìä

Configuration is resolved in the following order (later overrides earlier):

```
1. Default values (built-in)
   ‚Üì
2. azura.config.ts/json/yaml
   ‚Üì
3. Environment variables
   ‚Üì
4. Runtime overrides (programmatic)
```

### Example Hierarchy

```typescript
// 1. Defaults (built-in)
const defaults = {
  server: { port: 3000, cluster: false }
};

// 2. Config file
// azura.config.ts
const fileConfig = {
  server: { port: 8080 }  // Overrides default port
};

// 3. Environment variables
// PORT=9000
const envConfig = {
  server: { port: 9000 }  // Overrides file config port
};

// 4. Runtime override
const app = new AzuraClient({
  server: { port: 10000 }  // Overrides everything
});

// Final: port = 10000
```

### Programmatic Configuration

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient({
  environment: "production",
  server: {
    port: 3000,
    cluster: true
  }
});
```

## TypeScript Configuration üî∑

### Strict Typing

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "production",  // Type-checked
  server: {
    port: 3000,  // number
    cluster: true,  // boolean
    // invalidOption: true  // ‚ùå TypeScript error
  }
};

export default config;
```

### Custom Types Extension

```typescript title="types/config.d.ts"
import "azurajs/config";

declare module "azurajs/config" {
  interface ConfigTypes {
    database?: {
      host: string;
      port: number;
      name: string;
      ssl: boolean;
    };
    cache?: {
      enabled: boolean;
      ttl: number;
      maxSize: number;
    };
  }
}
```

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "production",
  server: {
    port: 3000
  },
  // Now available with IntelliSense
  database: {
    host: "localhost",
    port: 5432,
    name: "mydb",
    ssl: true
  },
  cache: {
    enabled: true,
    ttl: 3600,
    maxSize: 1000
  }
};

export default config;
```

### Type-Safe Environment Variables

```typescript
interface Env {
  NODE_ENV: "development" | "production" | "staging";
  PORT: string;
  DATABASE_URL: string;
  REDIS_URL?: string;
}

function getEnv<K extends keyof Env>(key: K): Env[K] {
  const value = process.env[key];
  if (!value) {
    throw new Error(`Missing environment variable: ${key}`);
  }
  return value as Env[K];
}

const config: ConfigTypes = {
  environment: getEnv("NODE_ENV"),
  server: {
    port: parseInt(getEnv("PORT"))
  }
};
```

## YAML/JSON Alternatives üìÑ

### JSON Configuration

```json title="azura.config.json"
{
  "environment": "production",
  "server": {
    "port": 3000,
    "cluster": true,
    "ipHost": false,
    "https": true
  },
  "logging": {
    "enabled": true,
    "showDetails": false,
    "level": "error"
  },
  "plugins": {
    "cors": {
      "enabled": true,
      "origins": ["https://yourdomain.com"],
      "methods": ["GET", "POST", "PUT", "DELETE"]
    },
    "rateLimit": {
      "enabled": true,
      "limit": 1000,
      "timeframe": 60000
    }
  }
}
```

### YAML Configuration

```yaml title="azura.config.yaml"
environment: production

server:
  port: 3000
  cluster: true
  ipHost: false
  https: true

logging:
  enabled: true
  showDetails: false
  level: error

plugins:
  cors:
    enabled: true
    origins:
      - https://yourdomain.com
      - https://app.yourdomain.com
    methods:
      - GET
      - POST
      - PUT
      - DELETE
    allowedHeaders:
      - Content-Type
      - Authorization
    credentials: true
    
  rateLimit:
    enabled: true
    limit: 1000
    timeframe: 60000
```

### Dynamic Format Selection

AzuraJS automatically detects and loads the configuration file:

```
Priority:
1. azura.config.ts
2. azura.config.js
3. azura.config.json
4. azura.config.yaml
5. azura.config.yml
```

## Configuration Validation ‚úÖ

### Built-in Validation

AzuraJS validates your configuration on startup:

```typescript
// ‚ùå This will throw an error
const config: ConfigTypes = {
  environment: "invalid",  // Error: Must be development|production|test|staging
  server: {
    port: "3000",  // Error: Must be number
    cluster: "yes"  // Error: Must be boolean
  }
};
```

### Custom Validation

```typescript title="validate-config.ts"
import type { ConfigTypes } from "azurajs/config";
import config from "./azura.config";

function validateConfig(config: ConfigTypes): void {
  // Port validation
  if (config.server?.port && (config.server.port < 1 || config.server.port > 65535)) {
    throw new Error(`Invalid port: ${config.server.port}. Must be between 1-65535`);
  }
  
  // Cluster + development warning
  if (config.server?.cluster && config.environment === "development") {
    console.warn("‚ö†Ô∏è Cluster mode enabled in development. Consider disabling for easier debugging.");
  }
  
  // Rate limit validation
  if (config.plugins?.rateLimit?.enabled) {
    const { limit, timeframe } = config.plugins.rateLimit;
    if (limit && timeframe && limit > 10000) {
      console.warn(`‚ö†Ô∏è High rate limit: ${limit}. Consider lowering for better protection.`);
    }
  }
  
  // CORS validation
  if (config.plugins?.cors?.enabled && config.environment === "production") {
    const origins = config.plugins.cors.origins;
    if (origins?.includes("*")) {
      throw new Error("üö® CORS wildcard (*) not allowed in production!");
    }
  }
}

validateConfig(config);
export default config;
```

### Zod Schema Validation

```bash
npm install zod
```

```typescript title="azura.config.ts"
import { z } from "zod";
import type { ConfigTypes } from "azurajs/config";

const ConfigSchema = z.object({
  environment: z.enum(["development", "production", "test", "staging"]),
  server: z.object({
    port: z.number().min(1).max(65535),
    cluster: z.boolean(),
    ipHost: z.boolean().optional(),
    https: z.boolean().optional(),
  }),
  logging: z.object({
    enabled: z.boolean(),
    showDetails: z.boolean(),
    level: z.enum(["trace", "debug", "info", "warn", "error", "fatal"]).optional()
  }).optional(),
  plugins: z.object({
    cors: z.object({
      enabled: z.boolean(),
      origins: z.array(z.string()).or(z.string()),
      methods: z.array(z.string()).optional(),
    }).optional(),
    rateLimit: z.object({
      enabled: z.boolean(),
      limit: z.number().positive(),
      timeframe: z.number().positive()
    }).optional()
  }).optional()
});

const rawConfig: ConfigTypes = {
  environment: "production",
  server: {
    port: 3000,
    cluster: true
  },
  logging: {
    enabled: true,
    showDetails: false
  }
};

// Validate
const config = ConfigSchema.parse(rawConfig);

export default config;
```

## Hot Reload üîÑ

AzuraJS supports configuration hot reloading in development:

### File Watcher Setup

```typescript title="config-watcher.ts"
import { watch } from "fs";
import { resolve } from "path";

const configPath = resolve(process.cwd(), "azura.config.ts");

let currentConfig = await import(configPath);

watch(configPath, async (eventType) => {
  if (eventType === "change") {
    // Clear module cache
    delete require.cache[require.resolve(configPath)];
    
    // Reload config
    currentConfig = await import(configPath);
    
    console.log("‚úÖ Configuration reloaded");
    
    // Apply new config
    app.updateConfig(currentConfig.default);
  }
});
```

### Development Mode Auto-Reload

```typescript title="server.ts"
import { AzuraClient } from "azurajs";
import config from "./azura.config";

const app = new AzuraClient(config);

if (config.environment === "development") {
  // Enable hot reload in development
  app.enableConfigHotReload();
}

app.listen();
```

### Graceful Config Updates

```typescript
class ConfigManager {
  private config: ConfigTypes;
  
  constructor(initialConfig: ConfigTypes) {
    this.config = initialConfig;
  }
  
  async reload() {
    const newConfig = await this.loadConfig();
    
    // Validate before applying
    this.validate(newConfig);
    
    // Apply only safe changes (not port, cluster)
    this.config.logging = newConfig.logging;
    this.config.plugins = newConfig.plugins;
    
    console.log("‚úÖ Configuration updated (some settings require restart)");
  }
  
  get current() {
    return this.config;
  }
}
```

## Secrets Management üîê

### Environment Variables for Secrets

```bash
# Never commit these!
DATABASE_PASSWORD=super-secret-password
JWT_SECRET=your-256-bit-secret
API_KEY=sk_live_xxxxxxxxxxxxx
ENCRYPTION_KEY=your-encryption-key
```

```typescript
const config: ConfigTypes = {
  // Safe: No secrets in config file
  server: { port: 3000 },
  
  // Load from environment
  database: {
    password: process.env.DATABASE_PASSWORD
  },
  jwt: {
    secret: process.env.JWT_SECRET
  }
};
```

### Using Vault Services

#### AWS Secrets Manager

```bash
npm install @aws-sdk/client-secrets-manager
```

```typescript
import { SecretsManagerClient, GetSecretValueCommand } from "@aws-sdk/client-secrets-manager";

async function getSecret(secretName: string): Promise<string> {
  const client = new SecretsManagerClient({ region: "us-east-1" });
  
  const response = await client.send(
    new GetSecretValueCommand({ SecretId: secretName })
  );
  
  return response.SecretString!;
}

const config: ConfigTypes = {
  database: {
    password: await getSecret("prod/database/password")
  },
  jwt: {
    secret: await getSecret("prod/jwt/secret")
  }
};
```

#### HashiCorp Vault

```bash
npm install node-vault
```

```typescript
import vault from "node-vault";

const vaultClient = vault({
  endpoint: process.env.VAULT_ADDR,
  token: process.env.VAULT_TOKEN
});

async function getVaultSecret(path: string): Promise<any> {
  const result = await vaultClient.read(path);
  return result.data;
}

const secrets = await getVaultSecret("secret/data/myapp");

const config: ConfigTypes = {
  database: {
    password: secrets.database_password
  }
};
```

### Encryption at Rest

```typescript
import { createCipheriv, createDecipheriv, randomBytes } from "crypto";

class SecretManager {
  private algorithm = "aes-256-gcm";
  private key = Buffer.from(process.env.ENCRYPTION_KEY!, "hex");
  
  encrypt(text: string): string {
    const iv = randomBytes(16);
    const cipher = createCipheriv(this.algorithm, this.key, iv);
    
    let encrypted = cipher.update(text, "utf8", "hex");
    encrypted += cipher.final("hex");
    
    const authTag = cipher.getAuthTag();
    
    return `${iv.toString("hex")}:${authTag.toString("hex")}:${encrypted}`;
  }
  
  decrypt(encrypted: string): string {
    const [ivHex, authTagHex, encryptedText] = encrypted.split(":");
    
    const iv = Buffer.from(ivHex, "hex");
    const authTag = Buffer.from(authTagHex, "hex");
    const decipher = createDecipheriv(this.algorithm, this.key, iv);
    
    decipher.setAuthTag(authTag);
    
    let decrypted = decipher.update(encryptedText, "hex", "utf8");
    decrypted += decipher.final("utf8");
    
    return decrypted;
  }
}

const secretManager = new SecretManager();
const encryptedPassword = secretManager.encrypt("my-password");
// Store encryptedPassword safely

// Later, decrypt when needed
const password = secretManager.decrypt(encryptedPassword);
```

## Best Practices üíé

### 1. Separate Configs by Environment

```
config/
  ‚îú‚îÄ‚îÄ azura.config.development.ts
  ‚îú‚îÄ‚îÄ azura.config.staging.ts
  ‚îú‚îÄ‚îÄ azura.config.production.ts
  ‚îî‚îÄ‚îÄ azura.config.test.ts
```

```typescript
const env = process.env.NODE_ENV || "development";
const config = await import(`./config/azura.config.${env}.ts`);

export default config.default;
```

### 2. Use Environment Variables for Secrets

```typescript
// ‚úÖ Good
const config = {
  apiKey: process.env.API_KEY
};

// ‚ùå Bad
const config = {
  apiKey: "sk_live_xxxxxxxxxxxxx"  // Never hardcode secrets!
};
```

### 3. Validate Configuration on Startup

```typescript
import config from "./azura.config";

// Validate required environment variables
const required = ["DATABASE_URL", "JWT_SECRET", "API_KEY"];
for (const key of required) {
  if (!process.env[key]) {
    throw new Error(`Missing required environment variable: ${key}`);
  }
}

// Validate config values
if (config.server.port < 1 || config.server.port > 65535) {
  throw new Error("Invalid port number");
}
```

### 4. Document Your Configuration

```typescript
/**
 * AzuraJS Configuration
 * 
 * Environment: Production
 * Last Updated: 2026-01-13
 * 
 * Configuration hierarchy:
 * 1. Defaults (azurajs built-in)
 * 2. This file
 * 3. Environment variables (.env.production)
 * 4. Runtime overrides (if any)
 */
const config: ConfigTypes = {
  // Core settings
  environment: "production",
  
  // Server configuration
  // Port can be overridden with PORT env var
  server: {
    port: 3000,
    cluster: true  // Enable for multi-core performance
  }
};
```

### 5. Use TypeScript for Type Safety

```typescript
// ‚úÖ Good: Type-safe
import type { ConfigTypes } from "azurajs/config";
const config: ConfigTypes = { /* ... */ };

// ‚ùå Bad: No type checking
const config = { /* ... */ };
```

### 6. Keep Sensitive Data Out of Git

```txt title=".gitignore"
.env
.env.local
.env.*.local
.env.production

# Keep templates
!.env.example
```

```bash title=".env.example"
NODE_ENV=production
PORT=3000

# Database (required)
DATABASE_URL=postgresql://user:password@localhost:5432/mydb

# Redis (optional)
REDIS_URL=redis://localhost:6379

# Secrets (required)
JWT_SECRET=your-secret-here
API_KEY=your-api-key-here
```

### 7. Provide Sensible Defaults

```typescript
const config: ConfigTypes = {
  environment: (process.env.NODE_ENV as any) || "development",
  server: {
    port: parseInt(process.env.PORT || "3000"),
    cluster: process.env.CLUSTER === "true" || false,
    https: process.env.HTTPS === "true" || false,
  },
  logging: {
    enabled: process.env.LOGGING !== "false",  // Default: true
    showDetails: process.env.LOG_DETAILS !== "false"  // Default: true
  }
};
```

### 8. Use Configuration Schemas

```typescript
import { z } from "zod";

const ServerSchema = z.object({
  port: z.number().min(1).max(65535).default(3000),
  cluster: z.boolean().default(false),
  https: z.boolean().default(false)
});

const config = {
  server: ServerSchema.parse(process.env)
};
```

### 9. Test Your Configuration

```typescript title="config.test.ts"
import { describe, it, expect } from "vitest";
import config from "./azura.config";

describe("Configuration", () => {
  it("should have valid port", () => {
    expect(config.server.port).toBeGreaterThan(0);
    expect(config.server.port).toBeLessThan(65536);
  });
  
  it("should not use wildcard CORS in production", () => {
    if (config.environment === "production") {
      expect(config.plugins?.cors?.origins).not.toContain("*");
    }
  });
  
  it("should enable rate limiting in production", () => {
    if (config.environment === "production") {
      expect(config.plugins?.rateLimit?.enabled).toBe(true);
    }
  });
});
```

### 10. Monitor Configuration Changes

```typescript
import { log } from "azurajs/logger";

const config: ConfigTypes = { /* ... */ };

// Log important config on startup
log.info("Configuration loaded", {
  environment: config.environment,
  port: config.server.port,
  cluster: config.server.cluster,
  corsEnabled: config.plugins?.cors?.enabled,
  rateLimitEnabled: config.plugins?.rateLimit?.enabled
});

// Warn about insecure settings
if (config.environment === "production") {
  if (!config.server.cluster) {
    log.warn("‚ö†Ô∏è Cluster mode disabled in production - consider enabling for better performance");
  }
  
  if (!config.plugins?.rateLimit?.enabled) {
    log.warn("‚ö†Ô∏è Rate limiting disabled in production - API may be vulnerable to abuse");
  }
}
```

## Troubleshooting üîç

### Configuration Not Loading

**Problem:** Configuration file not found

```
Error: Cannot find module './azura.config'
```

**Solutions:**
1. Ensure file exists in project root
2. Check file extension (.ts, .js, .json, .yaml)
3. Verify file name: `azura.config.ts` (not `azura-config.ts`)

```bash
# Check if file exists
ls -la azura.config.*

# Create if missing
touch azura.config.ts
```

### TypeScript Errors

**Problem:** Type errors in config file

```
Type 'string' is not assignable to type 'number'
```

**Solution:** Ensure correct types

```typescript
// ‚ùå Wrong
server: {
  port: "3000"  // String
}

// ‚úÖ Correct
server: {
  port: 3000  // Number
}

// ‚úÖ From environment (parse to number)
server: {
  port: parseInt(process.env.PORT || "3000")
}
```

### Environment Variables Not Working

**Problem:** Environment variables not loaded

**Solutions:**

1. **Install dotenv:**
```bash
npm install dotenv
```

2. **Load at the top of config:**
```typescript
import "dotenv/config";  // Must be first!
import type { ConfigTypes } from "azurajs/config";
```

3. **Check .env file location:**
```
project-root/
  ‚îú‚îÄ‚îÄ .env          ‚úÖ Correct location
  ‚îú‚îÄ‚îÄ src/
  ‚îÇ   ‚îî‚îÄ‚îÄ .env      ‚ùå Wrong location
  ‚îî‚îÄ‚îÄ azura.config.ts
```

4. **Verify .env syntax:**
```bash
# ‚úÖ Correct
PORT=3000
DATABASE_URL=postgresql://localhost/db

# ‚ùå Wrong (spaces around =)
PORT = 3000
DATABASE_URL = postgresql://localhost/db
```

### Cluster Mode Issues

**Problem:** Cluster mode not working

**Symptoms:**
- Only one process running
- Performance not improving

**Solutions:**

1. **Verify cluster is enabled:**
```typescript
server: {
  cluster: true  // Must be true
}
```

2. **Check worker count:**
```typescript
import os from "os";
console.log(`CPU cores: ${os.cpus().length}`);

server: {
  cluster: true,
  workers: os.cpus().length  // Explicitly set
}
```

3. **Test with:**
```bash
# Should show multiple processes
ps aux | grep node

# Or use PM2
pm2 start ecosystem.config.js
pm2 list
```

### CORS Not Working

**Problem:** CORS errors in browser

```
Access to fetch at 'http://localhost:3000' from origin 'http://localhost:5173' 
has been blocked by CORS policy
```

**Solutions:**

1. **Enable CORS plugin:**
```typescript
plugins: {
  cors: {
    enabled: true,  // Must be true
    origins: ["http://localhost:5173"]
  }
}
```

2. **Add your origin:**
```typescript
cors: {
  enabled: true,
  origins: [
    "http://localhost:5173",  // Your frontend URL
    "http://localhost:3000"
  ]
}
```

3. **Allow all in development:**
```typescript
cors: {
  enabled: true,
  origins: process.env.NODE_ENV === "development" ? ["*"] : ["https://yourdomain.com"]
}
```

4. **Include credentials:**
```typescript
cors: {
  enabled: true,
  origins: ["http://localhost:5173"],
  credentials: true,  // For cookies/auth
  allowedHeaders: ["Content-Type", "Authorization"]
}
```

### Rate Limiting Too Strict

**Problem:** Legitimate requests being blocked

```
429 Too Many Requests
```

**Solutions:**

1. **Increase limits:**
```typescript
rateLimit: {
  enabled: true,
  limit: 1000,  // Increase from 100
  timeframe: 60000
}
```

2. **Increase timeframe:**
```typescript
rateLimit: {
  enabled: true,
  limit: 100,
  timeframe: 300000  // 5 minutes instead of 1
}
```

3. **Disable in development:**
```typescript
rateLimit: {
  enabled: process.env.NODE_ENV === "production"
}
```

4. **Per-user rate limiting:**
```typescript
// Custom middleware with higher limits for authenticated users
function customRateLimit(req, res, next) {
  const limit = req.user ? 1000 : 100;
  // Apply limit...
}
```

### Port Already in Use

**Problem:** Cannot start server

```
Error: listen EADDRINUSE: address already in use :::3000
```

**Solutions:**

1. **Find and kill process:**
```bash
# Linux/Mac
lsof -i :3000
kill -9 <PID>

# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F
```

2. **Use different port:**
```typescript
server: {
  port: 3001  // Try different port
}
```

3. **Dynamic port selection:**
```typescript
server: {
  port: process.env.PORT ? parseInt(process.env.PORT) : 3000
}
```

### Configuration Not Updating

**Problem:** Changes not reflected after editing config

**Solutions:**

1. **Restart the server:**
```bash
# Stop server (Ctrl+C)
# Start again
npm run dev
```

2. **Clear Node cache (if using require):**
```bash
rm -rf node_modules/.cache
```

3. **Check for syntax errors:**
```bash
npx tsc --noEmit  # Check TypeScript
```

4. **Verify file is saved:**
- Check editor hasn't left file unsaved
- Look for dot indicator in tab

### Memory Issues in Cluster Mode

**Problem:** High memory usage with cluster mode

**Solutions:**

1. **Limit workers:**
```typescript
import os from "os";

server: {
  cluster: true,
  workers: Math.max(2, os.cpus().length - 2)  // Leave some cores free
}
```

2. **Monitor memory:**
```typescript
if (process.memoryUsage().heapUsed > 500 * 1024 * 1024) {  // 500MB
  console.warn("‚ö†Ô∏è High memory usage detected");
}
```

3. **Use PM2 with memory limits:**
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: "azura-app",
    script: "./server.js",
    instances: 4,
    max_memory_restart: "500M"  // Restart if exceeds 500MB
  }]
};
```

## Complete Production Example üöÄ

```typescript title="azura.config.production.ts"
import "dotenv/config";
import type { ConfigTypes } from "azurajs/config";
import { z } from "zod";

// Environment validation
const EnvSchema = z.object({
  NODE_ENV: z.enum(["production"]),
  PORT: z.string().transform(Number).pipe(z.number().min(1).max(65535)),
  DATABASE_URL: z.string().url(),
  REDIS_URL: z.string().url(),
  JWT_SECRET: z.string().min(32),
  ALLOWED_ORIGINS: z.string().transform(s => s.split(",")),
});

const env = EnvSchema.parse(process.env);

// Configuration
const config: ConfigTypes = {
  environment: "production",
  
  server: {
    port: env.PORT,
    cluster: true,
    workers: undefined,  // Use all cores
    ipHost: false,
    https: true,
    host: "0.0.0.0"
  },
  
  logging: {
    enabled: true,
    showDetails: false,  // Hide sensitive info
    level: "error"  // Only log errors
  },
  
  plugins: {
    cors: {
      enabled: true,
      origins: env.ALLOWED_ORIGINS,
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: [
        "Content-Type",
        "Authorization",
        "X-API-Key",
        "X-Request-ID"
      ],
      credentials: true,
      maxAge: 86400  // 24 hours
    },
    
    rateLimit: {
      enabled: true,
      limit: 1000,
      timeframe: 60000,
      message: "Too many requests. Please try again later."
    }
  }
};

// Validation
if (!config.server.cluster) {
  console.warn("‚ö†Ô∏è Cluster mode should be enabled in production");
}

if (!config.plugins?.rateLimit?.enabled) {
  throw new Error("Rate limiting must be enabled in production");
}

export default config;
```

```bash title=".env.production"
NODE_ENV=production
PORT=443

# Database
DATABASE_URL=postgresql://user:password@db.example.com:5432/myapp?ssl=true

# Cache
REDIS_URL=redis://redis.example.com:6379

# Security
JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long
API_KEY=your-api-key

# CORS
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com,https://www.yourdomain.com
```

## Next Steps üìñ

<Cards>
  <Card title="Logger" href="/docs/en/logger" description="Learn about the logging system" />
  <Card title="Performance" href="/docs/en/performance" description="Optimize your application" />
  <Card title="Cluster Mode" href="/docs/en/cluster-mode" description="Scale across multiple cores" />
  <Card title="Security" href="/docs/en/security" description="Secure your application" />
</Cards>
