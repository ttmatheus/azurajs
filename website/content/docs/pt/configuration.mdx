---
title: Configura√ß√£o
description: Guia completo para configurar sua aplica√ß√£o AzuraJS com TypeScript, vari√°veis de ambiente, valida√ß√£o e melhores pr√°ticas
icon: Settings
---

# Configura√ß√£o ‚öôÔ∏è

AzuraJS fornece um sistema de configura√ß√£o poderoso e flex√≠vel com suporte para TypeScript, JSON e YAML, integra√ß√£o com vari√°veis de ambiente, hot reloading, valida√ß√£o e gerenciamento de secrets.

## In√≠cio R√°pido üöÄ

Crie um arquivo `azura.config.ts` na raiz do seu projeto:

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "development",
  server: {
    port: 3000,
    cluster: false,
    ipHost: true,
    https: false,
  },
  logging: {
    enabled: true,
    showDetails: true,
  },
  plugins: {
    cors: {
      enabled: true,
      origins: ["*"],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: ["Content-Type", "Authorization"],
    },
    rateLimit: {
      enabled: false,
      limit: 100,
      timeframe: 60000,
    },
  },
};

export default config;
```

## Refer√™ncia de Op√ß√µes de Configura√ß√£o üìã

### Tabela Completa de Configura√ß√£o

| Op√ß√£o | Tipo | Padr√£o | Descri√ß√£o |
|-------|------|--------|-----------|
| `environment` | `"development"` \| `"production"` \| `"test"` \| `"staging"` | `"development"` | Modo do ambiente da aplica√ß√£o |
| `server.port` | `number` | `3000` | N√∫mero da porta do servidor |
| `server.cluster` | `boolean` | `false` | Habilitar clustering multi-core |
| `server.ipHost` | `boolean` | `false` | Exibir IP local na inicializa√ß√£o |
| `server.https` | `boolean` | `false` | Flag de protocolo HTTPS |
| `server.host` | `string` | `"0.0.0.0"` | Host de bind do servidor |
| `server.workers` | `number` | `os.cpus().length` | N√∫mero de workers do cluster |
| `logging.enabled` | `boolean` | `true` | Habilitar logging de requisi√ß√µes |
| `logging.showDetails` | `boolean` | `true` | Mostrar logs detalhados |
| `logging.level` | `"trace"` \| `"debug"` \| `"info"` \| `"warn"` \| `"error"` | `"info"` | N√≠vel m√≠nimo de log |
| `plugins.cors.enabled` | `boolean` | `false` | Habilitar plugin CORS |
| `plugins.cors.origins` | `string` \| `string[]` | `[]` | Origens permitidas |
| `plugins.cors.methods` | `string[]` | `["GET", "POST"]` | M√©todos HTTP permitidos |
| `plugins.cors.allowedHeaders` | `string[]` | `[]` | Headers de requisi√ß√£o permitidos |
| `plugins.cors.credentials` | `boolean` | `false` | Permitir credenciais |
| `plugins.cors.maxAge` | `number` | `86400` | Dura√ß√£o do cache preflight (segundos) |
| `plugins.rateLimit.enabled` | `boolean` | `false` | Habilitar rate limiting |
| `plugins.rateLimit.limit` | `number` | `100` | Requisi√ß√µes por per√≠odo |
| `plugins.rateLimit.timeframe` | `number` | `60000` | Janela de tempo em milissegundos |
| `plugins.rateLimit.message` | `string` | `"Too Many Requests"` | Mensagem de erro de rate limit |

### Configura√ß√£o de Ambiente

A configura√ß√£o `environment` afeta o comportamento da aplica√ß√£o:

```typescript
environment: "development" | "production" | "test" | "staging"
```

**Efeitos por ambiente:**

| Feature | Development | Production | Test | Staging |
|---------|-------------|------------|------|---------|
| Logs Detalhados | ‚úÖ Habilitado | ‚ùå Desabilitado | ‚úÖ Habilitado | ‚ö†Ô∏è M√≠nimo |
| Stack Traces | ‚úÖ Completo | ‚ùå Oculto | ‚úÖ Completo | ‚ö†Ô∏è Sanitizado |
| Hot Reload | ‚úÖ Habilitado | ‚ùå Desabilitado | ‚ùå Desabilitado | ‚ùå Desabilitado |
| Clustering | ‚ö†Ô∏è Opcional | ‚úÖ Recomendado | ‚ùå Desabilitado | ‚úÖ Recomendado |
| Sa√≠da Debug | ‚úÖ Verboso | ‚ùå Silencioso | ‚úÖ Verboso | ‚ö†Ô∏è Apenas Warnings |

<Callout type="info">
  Modo produ√ß√£o otimiza automaticamente a performance desabilitando logging detalhado e habilitando tratamento de erros eficiente.
</Callout>

## Op√ß√µes de Configura√ß√£o üîß

### Environment

```typescript
environment: "development" | "production" | "test"
```

Define o ambiente da aplica√ß√£o. Afeta o comportamento de logging e outros recursos espec√≠ficos do ambiente.

<Callout type="info">
  No modo produ√ß√£o, o logging detalhado √© automaticamente desabilitado para melhor performance.
</Callout>

### Configura√ß√£o do Servidor

#### port

```typescript
port: number
```

O n√∫mero da porta em que seu servidor ir√° escutar. Padr√£o: `3000`

```typescript
server: {
  port: 8080
}
```

#### cluster

```typescript
cluster: boolean
```

Habilita modo cluster para utilizar todos os n√∫cleos da CPU. Padr√£o: `false`

```typescript
server: {
  cluster: true  // Cria um worker para cada n√∫cleo da CPU
}
```

<Callout type="warn">
  Modo cluster √© recomendado para produ√ß√£o mas n√£o necess√°rio para desenvolvimento.
</Callout>

#### ipHost

```typescript
ipHost: boolean
```

Exibe o endere√ßo IP da rede local na inicializa√ß√£o. Padr√£o: `false`

```typescript
server: {
  ipHost: true  // Mostra: http://192.168.1.100:3000
}
```

#### https

```typescript
https: boolean
```

Indica se o servidor est√° rodando atr√°s de HTTPS. Afeta a propriedade `req.protocol`. Padr√£o: `false`

### Configura√ß√£o de Logging üìù

#### enabled

```typescript
enabled: boolean
```

Habilita/desabilita logging de requisi√ß√µes. Padr√£o: `true`

#### showDetails

```typescript
showDetails: boolean
```

Mostra informa√ß√µes detalhadas de requisi√ß√£o/resposta incluindo:
- M√©todo e caminho da requisi√ß√£o
- C√≥digo de status da resposta
- Tempo de resposta
- Corpo da requisi√ß√£o (em desenvolvimento)

```typescript
logging: {
  enabled: true,
  showDetails: true
}
```

Exemplo de sa√≠da:
```
‚Üí POST /api/users 201 Created (15ms)
```

### Plugin CORS üåê

Configure Cross-Origin Resource Sharing para sua API.

#### enabled

```typescript
enabled: boolean
```

Habilita/desabilita plugin CORS. Padr√£o: `false`

#### origins

```typescript
origins: string | string[]
```

Origens permitidas para requisi√ß√µes CORS.

```typescript
cors: {
  enabled: true,
  origins: ["https://example.com", "https://app.example.com"]
  // ou permitir todas: origins: ["*"]
}
```

#### methods

```typescript
methods: string | string[]
```

M√©todos HTTP permitidos.

```typescript
cors: {
  methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
}
```

#### allowedHeaders

```typescript
allowedHeaders: string | string[]
```

Cabe√ßalhos de requisi√ß√£o permitidos.

```typescript
cors: {
  allowedHeaders: ["Content-Type", "Authorization", "X-Requested-With"]
}
```

### Plugin Rate Limiting üõ°Ô∏è

Proteja sua API de abusos com rate limiting integrado.

#### enabled

```typescript
enabled: boolean
```

Habilita/desabilita rate limiting. Padr√£o: `false`

#### limit

```typescript
limit: number
```

N√∫mero m√°ximo de requisi√ß√µes por per√≠odo de tempo.

```typescript
rateLimit: {
  enabled: true,
  limit: 100  // 100 requisi√ß√µes por per√≠odo
}
```

#### timeframe

```typescript
timeframe: number
```

Per√≠odo de tempo em milissegundos.

```typescript
rateLimit: {
  limit: 100,
  timeframe: 60000  // 100 requisi√ß√µes por minuto
}
```

<Callout type="warn">
  Quando o limite √© excedido, o servidor responde com `429 Too Many Requests`
</Callout>

## Configura√ß√£o Espec√≠fica por Ambiente üåç

Use vari√°veis de ambiente para diferentes ambientes de deploy:

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const isDev = process.env.NODE_ENV !== "production";
const port = process.env.PORT ? parseInt(process.env.PORT) : 3000;

const config: ConfigTypes = {
  environment: isDev ? "development" : "production",
  server: {
    port,
    cluster: !isDev,  // Habilita cluster apenas em produ√ß√£o
    ipHost: isDev,    // Mostra IP apenas em desenvolvimento
    https: !isDev,
  },
  logging: {
    enabled: true,
    showDetails: isDev,  // Logs detalhados apenas em desenvolvimento
  },
  plugins: {
    cors: {
      enabled: true,
      origins: isDev 
        ? ["*"] 
        : ["https://seudominio.com"],
    },
    rateLimit: {
      enabled: !isDev,  // Rate limit apenas em produ√ß√£o
      limit: 100,
      timeframe: 60000,
    },
  },
};

export default config;
```

## Configura√ß√£o JSON üìã

Voc√™ tamb√©m pode usar formato JSON:

```json title="azura.config.json"
{
  "environment": "development",
  "server": {
    "port": 3000,
    "cluster": false
  },
  "logging": {
    "enabled": true,
    "showDetails": true
  }
}
```

## Configura√ß√£o YAML üìÑ

Ou formato YAML:

```yaml title="azura.config.yaml"
environment: development
server:
  port: 3000
  cluster: false
logging:
  enabled: true
  showDetails: true
```

## Acessando Configura√ß√£o em Runtime üîç

Voc√™ pode acessar a configura√ß√£o na sua aplica√ß√£o:

```typescript
const app = new AzuraClient();
const config = app.getConfig();

console.log(`Porta do servidor: ${config.server?.port}`);
console.log(`Ambiente: ${config.environment}`);
```

## Exemplo de Configura√ß√£o Completa üìö

Aqui est√° uma configura√ß√£o completa pronta para produ√ß√£o:

```typescript title="azura.config.ts"
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "production",
  server: {
    port: 8080,
    cluster: true,
    ipHost: false,
    https: true,
  },
  logging: {
    enabled: true,
    showDetails: false,
  },
  plugins: {
    cors: {
      enabled: true,
      origins: [
        "https://seudominio.com",
        "https://app.seudominio.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: [
        "Content-Type", 
        "Authorization",
        "X-API-Key"
      ],
    },
    rateLimit: {
      enabled: true,
      limit: 1000,
      timeframe: 60000, // 1000 requisi√ß√µes por minuto
    },
  },
};

export default config;
```

## Integra√ß√£o com Vari√°veis de Ambiente üîê

### Vari√°veis de Ambiente B√°sicas

```typescript
const config: ConfigTypes = {
  environment: (process.env.NODE_ENV as any) || "development",
  server: {
    port: parseInt(process.env.PORT || "3000"),
    cluster: process.env.CLUSTER === "true",
    https: process.env.HTTPS === "true"
  }
};
```

### Usando Arquivos .env

```bash
npm install dotenv
```

```bash title=".env"
NODE_ENV=production
PORT=8080
CLUSTER=true
HTTPS=true

# CORS
CORS_ORIGINS=https://seudominio.com,https://app.seudominio.com

# Rate Limiting
RATE_LIMIT=1000
RATE_TIMEFRAME=60000

# Secrets
DATABASE_URL=postgresql://user:pass@localhost:5432/mydb
JWT_SECRET=your-256-bit-secret
API_KEY=your-api-key
```

```typescript title="azura.config.ts"
import "dotenv/config";

const config: ConfigTypes = {
  environment: process.env.NODE_ENV as any,
  server: {
    port: parseInt(process.env.PORT!),
    cluster: process.env.CLUSTER === "true"
  },
  plugins: {
    cors: {
      enabled: true,
      origins: process.env.CORS_ORIGINS?.split(",") || []
    }
  }
};
```

## Hierarquia de Configura√ß√£o üìä

A configura√ß√£o √© resolvida nesta ordem:

```
1. Valores padr√£o (built-in)
   ‚Üì
2. azura.config.ts/json/yaml
   ‚Üì
3. Vari√°veis de ambiente
   ‚Üì
4. Sobrescritas em runtime
```

## Configura√ß√£o TypeScript üî∑

### Tipagem Estrita

```typescript
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  environment: "production",  // ‚úÖ Verifica√ß√£o de tipo
  server: {
    port: 3000,  // ‚úÖ number
    // opcaoInvalida: true  // ‚ùå Erro TypeScript
  }
};
```

### Extens√£o de Tipos Customizados

```typescript title="types/config.d.ts"
import "azurajs/config";

declare module "azurajs/config" {
  interface ConfigTypes {
    database?: {
      host: string;
      port: number;
      name: string;
    };
  }
}
```

```typescript
const config: ConfigTypes = {
  environment: "production",
  database: {  // ‚úÖ Agora dispon√≠vel com IntelliSense
    host: "localhost",
    port: 5432,
    name: "mydb"
  }
};
```

## Alternativas YAML/JSON üìÑ

### Configura√ß√£o JSON

```json title="azura.config.json"
{
  "environment": "production",
  "server": {
    "port": 3000,
    "cluster": true
  },
  "logging": {
    "enabled": true,
    "showDetails": false
  }
}
```

### Configura√ß√£o YAML

```yaml title="azura.config.yaml"
environment: production
server:
  port: 3000
  cluster: true
logging:
  enabled: true
  showDetails: false
plugins:
  cors:
    enabled: true
    origins:
      - https://seudominio.com
  rateLimit:
    enabled: true
    limit: 1000
    timeframe: 60000
```

## Valida√ß√£o de Configura√ß√£o ‚úÖ

### Valida√ß√£o com Schema Zod

```bash
npm install zod
```

```typescript
import { z } from "zod";

const ConfigSchema = z.object({
  environment: z.enum(["development", "production", "test", "staging"]),
  server: z.object({
    port: z.number().min(1).max(65535),
    cluster: z.boolean()
  })
});

const config = ConfigSchema.parse(rawConfig);
```

### Valida√ß√£o Customizada

```typescript
function validateConfig(config: ConfigTypes): void {
  // Valida√ß√£o de porta
  if (config.server?.port && (config.server.port < 1 || config.server.port > 65535)) {
    throw new Error(`Porta inv√°lida: ${config.server.port}`);
  }
  
  // Verifica√ß√µes de seguran√ßa em produ√ß√£o
  if (config.environment === "production") {
    if (config.plugins?.cors?.origins?.includes("*")) {
      throw new Error("CORS wildcard n√£o permitido em produ√ß√£o");
    }
    if (!config.plugins?.rateLimit?.enabled) {
      console.warn("‚ö†Ô∏è Rate limiting desabilitado em produ√ß√£o");
    }
  }
}
```

## Hot Reload üîÑ

```typescript
import { watch } from "fs";

const configPath = "./azura.config.ts";

watch(configPath, async (eventType) => {
  if (eventType === "change") {
    delete require.cache[require.resolve(configPath)];
    const newConfig = await import(configPath);
    app.updateConfig(newConfig.default);
    console.log("‚úÖ Configura√ß√£o recarregada");
  }
});
```

## Gerenciamento de Secrets üîê

### Vari√°veis de Ambiente

```typescript
// ‚úÖ Bom: Carregar do ambiente
const config = {
  jwt: {
    secret: process.env.JWT_SECRET
  }
};

// ‚ùå Ruim: Nunca hardcode
const config = {
  jwt: {
    secret: "minha-chave-secreta"  // ‚ùå Nunca fa√ßa isso!
  }
};
```

### AWS Secrets Manager

```bash
npm install @aws-sdk/client-secrets-manager
```

```typescript
import { SecretsManagerClient, GetSecretValueCommand } from "@aws-sdk/client-secrets-manager";

async function getSecret(secretName: string): Promise<string> {
  const client = new SecretsManagerClient({ region: "us-east-1" });
  
  const response = await client.send(
    new GetSecretValueCommand({ SecretId: secretName })
  );
  
  return response.SecretString!;
}

const config: ConfigTypes = {
  database: {
    password: await getSecret("prod/database/password")
  },
  jwt: {
    secret: await getSecret("prod/jwt/secret")
  }
};
```

### HashiCorp Vault

```bash
npm install node-vault
```

```typescript
import vault from "node-vault";

const vaultClient = vault({
  endpoint: process.env.VAULT_ADDR,
  token: process.env.VAULT_TOKEN
});

async function getVaultSecret(path: string): Promise<any> {
  const result = await vaultClient.read(path);
  return result.data;
}

const secrets = await getVaultSecret("secret/data/myapp");

const config: ConfigTypes = {
  database: {
    password: secrets.database_password
  }
};
```

### Criptografia em Repouso

```typescript
import { createCipheriv, createDecipheriv, randomBytes } from "crypto";

class SecretManager {
  private algorithm = "aes-256-gcm";
  private key = Buffer.from(process.env.ENCRYPTION_KEY!, "hex");
  
  encrypt(text: string): string {
    const iv = randomBytes(16);
    const cipher = createCipheriv(this.algorithm, this.key, iv);
    
    let encrypted = cipher.update(text, "utf8", "hex");
    encrypted += cipher.final("hex");
    
    const authTag = cipher.getAuthTag();
    
    return `${iv.toString("hex")}:${authTag.toString("hex")}:${encrypted}`;
  }
  
  decrypt(encrypted: string): string {
    const [ivHex, authTagHex, encryptedText] = encrypted.split(":");
    
    const iv = Buffer.from(ivHex, "hex");
    const authTag = Buffer.from(authTagHex, "hex");
    const decipher = createDecipheriv(this.algorithm, this.key, iv);
    
    decipher.setAuthTag(authTag);
    
    let decrypted = decipher.update(encryptedText, "hex", "utf8");
    decrypted += decipher.final("utf8");
    
    return decrypted;
  }
}

const secretManager = new SecretManager();
const encryptedPassword = secretManager.encrypt("minha-senha");
// Armazene encryptedPassword com seguran√ßa

// Depois, descriptografe quando necess√°rio
const password = secretManager.decrypt(encryptedPassword);
```

## Melhores Pr√°ticas üíé

### 1. Separar Configs por Ambiente

```
config/
  ‚îú‚îÄ‚îÄ azura.config.development.ts
  ‚îú‚îÄ‚îÄ azura.config.staging.ts
  ‚îî‚îÄ‚îÄ azura.config.production.ts
```

### 2. Usar Vari√°veis de Ambiente para Secrets

```typescript
// ‚úÖ Bom
apiKey: process.env.API_KEY

// ‚ùå Ruim
apiKey: "sk_live_xxxxx"
```

### 3. Validar na Inicializa√ß√£o

```typescript
const required = ["DATABASE_URL", "JWT_SECRET"];
for (const key of required) {
  if (!process.env[key]) {
    throw new Error(`Faltando: ${key}`);
  }
}
```

### 4. Documentar Configura√ß√£o

```typescript
/**
 * Configura√ß√£o de Produ√ß√£o
 * √öltima Atualiza√ß√£o: 2026-01-13
 * 
 * Hierarquia:
 * 1. Padr√µes
 * 2. Este arquivo
 * 3. Vari√°veis de ambiente
 */
const config: ConfigTypes = { /* ... */ };
```

### 5. TypeScript para Seguran√ßa de Tipos

```typescript
import type { ConfigTypes } from "azurajs/config";
const config: ConfigTypes = { /* ... */ };
```

### 6. Manter Secrets Fora do Git

```txt
.env
.env.local
.env.*.local
.env.production
```

### 7. Fornecer Padr√µes Sensatos

```typescript
const config = {
  port: parseInt(process.env.PORT || "3000"),
  cluster: process.env.CLUSTER === "true" || false
};
```

### 8. Testar Configura√ß√£o

```typescript title="config.test.ts"
import { describe, it, expect } from "vitest";
import config from "./azura.config";

describe("Configura√ß√£o", () => {
  it("deve ter porta v√°lida", () => {
    expect(config.server.port).toBeGreaterThan(0);
    expect(config.server.port).toBeLessThan(65536);
  });
  
  it("n√£o deve usar CORS wildcard em produ√ß√£o", () => {
    if (config.environment === "production") {
      expect(config.plugins?.cors?.origins).not.toContain("*");
    }
  });
  
  it("deve habilitar rate limiting em produ√ß√£o", () => {
    if (config.environment === "production") {
      expect(config.plugins?.rateLimit?.enabled).toBe(true);
    }
  });
});
```

### 9. Usar Schemas de Configura√ß√£o

```typescript
import { z } from "zod";

const ServerSchema = z.object({
  port: z.number().min(1).max(65535).default(3000),
  cluster: z.boolean().default(false),
  https: z.boolean().default(false)
});

const config = {
  server: ServerSchema.parse(process.env)
};
```

### 10. Monitorar Mudan√ßas de Configura√ß√£o

```typescript
import { log } from "azurajs/logger";

const config: ConfigTypes = { /* ... */ };

// Logar configura√ß√£o importante na inicializa√ß√£o
log.info("Configura√ß√£o carregada", {
  environment: config.environment,
  port: config.server.port,
  cluster: config.server.cluster,
  corsEnabled: config.plugins?.cors?.enabled,
  rateLimitEnabled: config.plugins?.rateLimit?.enabled
});

// Alertar sobre configura√ß√µes inseguras
if (config.environment === "production") {
  if (!config.server.cluster) {
    log.warn("‚ö†Ô∏è Cluster mode desabilitado em produ√ß√£o - considere habilitar para melhor performance");
  }
  
  if (!config.plugins?.rateLimit?.enabled) {
    log.warn("‚ö†Ô∏è Rate limiting desabilitado em produ√ß√£o - API pode estar vulner√°vel a abusos");
  }
}
```

## Solu√ß√£o de Problemas üîç

### Configura√ß√£o N√£o Carrega

**Problema:** Arquivo de configura√ß√£o n√£o encontrado

```
Error: Cannot find module './azura.config'
```

**Solu√ß√µes:**
1. Garanta que o arquivo existe na raiz do projeto
2. Verifique a extens√£o do arquivo (.ts, .js, .json, .yaml)
3. Verifique o nome do arquivo: `azura.config.ts` (n√£o `azura-config.ts`)

```bash
# Verificar se arquivo existe
ls azura.config.*

# Criar se estiver faltando
touch azura.config.ts
```

### Erros TypeScript

**Problema:** Erros de tipo no arquivo de configura√ß√£o

```
Type 'string' is not assignable to type 'number'
```

**Solu√ß√£o:** Garanta tipos corretos

```typescript
// ‚ùå Errado
server: {
  port: "3000"  // String
}

// ‚úÖ Correto
server: {
  port: 3000  // Number
}

// ‚úÖ Do ambiente (parse para n√∫mero)
server: {
  port: parseInt(process.env.PORT || "3000")
}
```

### Vari√°veis de Ambiente N√£o Funcionam

**Problema:** Vari√°veis de ambiente n√£o carregam

**Solu√ß√µes:**

1. **Instalar dotenv:**
```bash
npm install dotenv
```

2. **Carregar no topo do config:**
```typescript
import "dotenv/config";  // Deve ser primeiro!
import type { ConfigTypes } from "azurajs/config";
```

3. **Verificar localiza√ß√£o do arquivo .env:**
```
project-root/
  ‚îú‚îÄ‚îÄ .env          ‚úÖ Localiza√ß√£o correta
  ‚îú‚îÄ‚îÄ src/
  ‚îÇ   ‚îî‚îÄ‚îÄ .env      ‚ùå Localiza√ß√£o errada
  ‚îî‚îÄ‚îÄ azura.config.ts
```

4. **Verificar sintaxe do .env:**
```bash
# ‚úÖ Correto
PORT=3000
DATABASE_URL=postgresql://localhost/db

# ‚ùå Errado (espa√ßos ao redor do =)
PORT = 3000
DATABASE_URL = postgresql://localhost/db
```

### Problemas com Cluster Mode

**Problema:** Cluster mode n√£o funciona

**Sintomas:**
- Apenas um processo rodando
- Performance n√£o melhora

**Solu√ß√µes:**

1. **Verificar se cluster est√° habilitado:**
```typescript
server: {
  cluster: true  // Deve ser true
}
```

2. **Verificar contagem de workers:**
```typescript
import os from "os";
console.log(`N√∫cleos CPU: ${os.cpus().length}`);

server: {
  cluster: true,
  workers: os.cpus().length  // Definir explicitamente
}
```

3. **Testar com:**
```bash
# Deve mostrar m√∫ltiplos processos
ps aux | grep node

# Ou usar PM2
pm2 start ecosystem.config.js
pm2 list
```

### CORS N√£o Funciona

**Problema:** Erros de CORS no navegador

```
Access to fetch at 'http://localhost:3000' from origin 'http://localhost:5173' 
has been blocked by CORS policy
```

**Solu√ß√µes:**

1. **Habilitar plugin CORS:**
```typescript
plugins: {
  cors: {
    enabled: true,  // Deve ser true
    origins: ["http://localhost:5173"]
  }
}
```

2. **Adicionar sua origem:**
```typescript
cors: {
  enabled: true,
  origins: [
    "http://localhost:5173",  // URL do seu frontend
    "http://localhost:3000"
  ]
}
```

3. **Permitir tudo em desenvolvimento:**
```typescript
cors: {
  enabled: true,
  origins: process.env.NODE_ENV === "development" ? ["*"] : ["https://seudominio.com"]
}
```

4. **Incluir credenciais:**
```typescript
cors: {
  enabled: true,
  origins: ["http://localhost:5173"],
  credentials: true,  // Para cookies/auth
  allowedHeaders: ["Content-Type", "Authorization"]
}
```

### Rate Limiting Muito Restritivo

**Problema:** Requisi√ß√µes leg√≠timas sendo bloqueadas

```
429 Too Many Requests
```

**Solu√ß√µes:**

1. **Aumentar limites:**
```typescript
rateLimit: {
  enabled: true,
  limit: 1000,  // Aumentar de 100
  timeframe: 60000
}
```

2. **Aumentar per√≠odo:**
```typescript
rateLimit: {
  enabled: true,
  limit: 100,
  timeframe: 300000  // 5 minutos ao inv√©s de 1
}
```

3. **Desabilitar em desenvolvimento:**
```typescript
rateLimit: {
  enabled: process.env.NODE_ENV === "production"
}
```

### Porta J√° em Uso

**Problema:** N√£o consegue iniciar servidor

```
Error: listen EADDRINUSE: address already in use :::3000
```

**Solu√ß√µes:**

1. **Encontrar e matar processo:**
```bash
# Linux/Mac
lsof -i :3000
kill -9 <PID>

# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F
```

2. **Usar porta diferente:**
```typescript
server: {
  port: 3001  // Tentar porta diferente
}
```

3. **Sele√ß√£o din√¢mica de porta:**
```typescript
server: {
  port: process.env.PORT ? parseInt(process.env.PORT) : 3000
}
```

### Configura√ß√£o N√£o Atualiza

**Problema:** Mudan√ßas n√£o refletem ap√≥s editar config

**Solu√ß√µes:**

1. **Reiniciar o servidor:**
```bash
# Parar servidor (Ctrl+C)
# Iniciar novamente
npm run dev
```

2. **Limpar cache do Node (se usando require):**
```bash
rm -rf node_modules/.cache
```

3. **Verificar erros de sintaxe:**
```bash
npx tsc --noEmit  # Verificar TypeScript
```

### Problemas de Mem√≥ria em Cluster Mode

**Problema:** Alto uso de mem√≥ria com cluster mode

**Solu√ß√µes:**

1. **Limitar workers:**
```typescript
import os from "os";

server: {
  cluster: true,
  workers: Math.max(2, os.cpus().length - 2)  // Deixar alguns cores livres
}
```

2. **Monitorar mem√≥ria:**
```typescript
if (process.memoryUsage().heapUsed > 500 * 1024 * 1024) {  // 500MB
  console.warn("‚ö†Ô∏è Alto uso de mem√≥ria detectado");
}
```

3. **Usar PM2 com limites de mem√≥ria:**
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: "azura-app",
    script: "./server.js",
    instances: 4,
    max_memory_restart: "500M"  // Reiniciar se exceder 500MB
  }]
};
```

## Exemplo Completo de Produ√ß√£o üöÄ

```typescript title="azura.config.production.ts"
import "dotenv/config";
import type { ConfigTypes } from "azurajs/config";
import { z } from "zod";

// Validar ambiente
const EnvSchema = z.object({
  NODE_ENV: z.enum(["production"]),
  PORT: z.string().transform(Number),
  DATABASE_URL: z.string().url(),
  JWT_SECRET: z.string().min(32),
  ALLOWED_ORIGINS: z.string().transform(s => s.split(","))
});

const env = EnvSchema.parse(process.env);

const config: ConfigTypes = {
  environment: "production",
  server: {
    port: env.PORT,
    cluster: true,
    https: true
  },
  logging: {
    enabled: true,
    showDetails: false
  },
  plugins: {
    cors: {
      enabled: true,
      origins: env.ALLOWED_ORIGINS,
      credentials: true
    },
    rateLimit: {
      enabled: true,
      limit: 1000,
      timeframe: 60000
    }
  }
};

export default config;
```

## Pr√≥ximos Passos üìñ

<Cards>
  <Card title="Logger" href="/docs/pt/logger" description="Sistema de logging avan√ßado" />
  <Card title="Performance" href="/docs/pt/performance" description="T√©cnicas de otimiza√ß√£o" />
  <Card title="Cluster Mode" href="/docs/pt/cluster-mode" description="Escalabilidade multi-core" />
</Cards>
