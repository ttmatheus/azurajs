---
title: Extens√µes de Tipo
description: Estenda Request, Response e AzuraClient com propriedades personalizadas
icon: Code
---

# Extens√µes de Tipo üîß

AzuraJS permite que voc√™ estenda tipos principais (Request, Response, AzuraClient) com propriedades e m√©todos personalizados, similar ao Express mas com suporte completo ao TypeScript.

## In√≠cio R√°pido üöÄ

### TypeScript

```typescript
// types/express.d.ts
declare module 'azura' {
  interface RequestServer {
    user?: { id: string; name: string };
    session?: any;
  }
  
  interface ResponseServer {
    sendSuccess(data: any): this;
  }
}

// Implementa√ß√£o
app.use((req, res, next) => {
  res.sendSuccess = function(data: any) {
    return this.status(200).json({ success: true, data });
  };
  next();
});

// Uso - agora totalmente tipado!
app.get('/data', (req, res) => {
  res.sendSuccess({ message: 'Ol√°' });  // TypeScript conhece sendSuccess!
});
```

### JavaScript

```javascript
// Sem tipos necess√°rios - apenas estenda!
app.use((req, res, next) => {
  res.sendSuccess = function(data) {
    return this.status(200).json({ success: true, data });
  };
  next();
});
```

## Estendendo Request üì•

### Adicionando Propriedade User

```typescript
// types.ts
declare module 'azura' {
  interface RequestServer {
    user?: {
      id: string;
      email: string;
      role: 'admin' | 'user';
    };
    isAuthenticated(): boolean;
  }
}

// middleware/auth.ts
app.use((req, res, next) => {
  const token = req.header('authorization')?.replace('Bearer ', '');
  
  if (token) {
    req.user = decodeToken(token);
  }
  
  req.isAuthenticated = function() {
    return !!this.user;
  };
  
  next();
});

// routes/protected.ts
app.get('/profile', (req, res) => {
  if (!req.isAuthenticated()) {  // TypeScript conhece este m√©todo!
    return res.status(401).json({ error: 'N√£o autorizado' });
  }
  
  res.json({ user: req.user });  // TypeScript conhece a propriedade user!
});
```

### Adicionando Session

```typescript
declare module 'azura' {
  interface RequestServer {
    session?: {
      id: string;
      data: Record<string, any>;
    };
    startSession(data?: any): void;
    destroySession(): void;
  }
}

const sessions = new Map();

app.use((req, res, next) => {
  const sessionId = req.cookies['session-id'];
  
  if (sessionId && sessions.has(sessionId)) {
    req.session = sessions.get(sessionId);
  }
  
  req.startSession = function(data = {}) {
    const id = generateId();
    this.session = { id, data };
    sessions.set(id, this.session);
    res.cookie('session-id', id, { httpOnly: true });
  };
  
  req.destroySession = function() {
    if (this.session) {
      sessions.delete(this.session.id);
      this.session = undefined;
      res.clearCookie('session-id');
    }
  };
  
  next();
});
```

## Estendendo Response üì§

### M√©todos de Response Personalizados

```typescript
declare module 'azura' {
  interface ResponseServer {
    sendSuccess(data: any, message?: string): this;
    sendError(message: string, code?: number): this;
    paginate(data: any[], page: number, limit: number): this;
    notFound(message?: string): this;
    badRequest(message?: string): this;
  }
}

app.use((req, res, next) => {
  res.sendSuccess = function(data: any, message?: string) {
    return this.status(200).json({
      success: true,
      message: message || 'Requisi√ß√£o bem-sucedida',
      data,
      timestamp: new Date().toISOString()
    });
  };
  
  res.sendError = function(message: string, code = 400) {
    return this.status(code).json({
      success: false,
      error: message,
      timestamp: new Date().toISOString()
    });
  };
  
  res.paginate = function(data: any[], page: number, limit: number) {
    const startIndex = (page - 1) * limit;
    const endIndex = page * limit;
    
    return this.status(200).json({
      success: true,
      data: data.slice(startIndex, endIndex),
      pagination: {
        page,
        limit,
        total: data.length,
        totalPages: Math.ceil(data.length / limit),
        hasNext: endIndex < data.length,
        hasPrev: page > 1
      }
    });
  };
  
  res.notFound = function(message = 'N√£o encontrado') {
    return this.status(404).json({ error: message });
  };
  
  res.badRequest = function(message = 'Requisi√ß√£o inv√°lida') {
    return this.status(400).json({ error: message });
  };
  
  next();
});

// Uso
app.get('/users', (req, res) => {
  const users = getUsers();
  res.sendSuccess(users);  // Totalmente tipado!
});

app.get('/user/:id', (req, res) => {
  const user = findUser(req.params.id);
  if (!user) {
    return res.notFound('Usu√°rio n√£o encontrado');
  }
  res.sendSuccess(user);
});
```

## Estendendo AzuraClient üöÄ

### Adicionando Health Check

```typescript
declare module 'azura' {
  interface AzuraClient {
    health(path?: string): void;
    version(version: string, path?: string): void;
    enableCors(options?: CorsOptions): void;
  }
}

// Estender prototype
import { AzuraClient } from 'azura';

AzuraClient.prototype.health = function(path = '/health') {
  this.get(path, (req, res) => {
    res.json({
      status: 'healthy',
      uptime: process.uptime(),
      memory: process.memoryUsage(),
      timestamp: Date.now()
    });
  });
};

AzuraClient.prototype.version = function(version: string, path = '/version') {
  this.get(path, (req, res) => {
    res.json({ version });
  });
};

AzuraClient.prototype.enableCors = function(options = {}) {
  const { origin = '*', methods = 'GET,POST,PUT,DELETE', headers = 'Content-Type,Authorization' } = options;
  
  this.use((req, res, next) => {
    res.set('Access-Control-Allow-Origin', origin);
    res.set('Access-Control-Allow-Methods', methods);
    res.set('Access-Control-Allow-Headers', headers);
    
    if (req.method === 'OPTIONS') {
      return res.status(204).send();
    }
    
    next();
  });
};

// Uso
const app = new AzuraClient();
app.health();              // Adiciona endpoint /health
app.version('1.0.0');      // Adiciona endpoint /version
app.enableCors();          // Habilita CORS
```

## Extens√µes JavaScript üìú

Sem TypeScript? Sem problema! Estenda com JavaScript puro:

```javascript
const { AzuraClient } = require('azura');

const app = new AzuraClient();

// M√©todo 1: Estender em middleware
app.use((req, res, next) => {
  // Adicionar ao response
  res.sendSuccess = function(data) {
    return this.status(200).json({ success: true, data });
  };
  
  // Adicionar ao request
  req.isLocalhost = function() {
    return this.ip === '127.0.0.1' || this.ip === '::1';
  };
  
  next();
});

// M√©todo 2: Estender prototype
AzuraClient.prototype.health = function(path) {
  const healthPath = path || '/health';
  this.get(healthPath, (req, res) => {
    res.json({
      status: 'ok',
      uptime: process.uptime()
    });
  });
};

app.health(); // Agora dispon√≠vel!
```

## Exemplos Pr√°ticos üí°

### Acesso ao Banco de Dados

```typescript
declare module 'azura' {
  interface RequestServer {
    db: PrismaClient;  // ou qualquer ORM
  }
}

const prisma = new PrismaClient();

app.use((req, res, next) => {
  req.db = prisma;
  next();
});

// Agora use req.db em qualquer lugar!
app.get('/users', async (req, res) => {
  const users = await req.db.user.findMany();
  res.json(users);
});
```

### Helper de Valida√ß√£o de Request

```typescript
declare module 'azura' {
  interface RequestServer {
    validate(schema: any): any;
    requireFields(...fields: string[]): any;
  }
}

app.use((req, res, next) => {
  req.validate = function(schema: any) {
    const { error, value } = schema.validate(this.body);
    if (error) throw new Error(error.message);
    return value;
  };
  
  req.requireFields = function(...fields: string[]) {
    const missing = fields.filter(f => !this.body[f]);
    if (missing.length > 0) {
      throw new Error(`Campos faltando: ${missing.join(', ')}`);
    }
    return this.body;
  };
  
  next();
});

// Uso
app.post('/create', (req, res) => {
  try {
    req.requireFields('name', 'email');
    const data = req.body;
    // Criar recurso...
    res.sendSuccess(data);
  } catch (error) {
    res.badRequest(error.message);
  }
});
```

### Tempo de Resposta

```typescript
declare module 'azura' {
  interface ResponseServer {
    _startTime?: number;
  }
}

app.use((req, res, next) => {
  res._startTime = Date.now();
  
  const originalJson = res.json.bind(res);
  res.json = function(data: any) {
    const responseTime = Date.now() - (this._startTime || 0);
    this.set('X-Response-Time', `${responseTime}ms`);
    
    if (typeof data === 'object' && data !== null) {
      data._meta = {
        responseTime: `${responseTime}ms`,
        timestamp: new Date().toISOString()
      };
    }
    
    return originalJson(data);
  };
  
  next();
});
```

## Melhores Pr√°ticas üíé

1. **Sempre declare tipos** em um arquivo .d.ts
2. **Use module augmentation** (`declare module 'azura'`)
3. **Implemente em middleware** ou no in√≠cio da aplica√ß√£o
4. **Mantenha extens√µes m√≠nimas** - n√£o sobrecarregue objetos principais
5. **Documente propriedades personalizadas** para membros da equipe
6. **Use namespaces** para evitar conflitos
7. **Teste extens√µes completamente**

## Exemplo Completo üéØ

```typescript
// types/azura-extensions.d.ts
declare module 'azura' {
  interface RequestServer {
    user?: User;
    session?: Session;
    isAuthenticated(): boolean;
    db: PrismaClient;
  }
  
  interface ResponseServer {
    sendSuccess(data: any, message?: string): this;
    sendError(message: string, code?: number): this;
    notFound(message?: string): this;
  }
  
  interface AzuraClient {
    health(path?: string): void;
  }
}

// app.ts
import { AzuraClient } from 'azura';
import { PrismaClient } from '@prisma/client';

const app = new AzuraClient();
const prisma = new PrismaClient();

// Configurar extens√µes
import './middleware/extensions';

// Habilitar health check
app.health();

// Usar extens√µes tipadas
app.get('/users', async (req, res) => {
  if (!req.isAuthenticated()) {
    return res.notFound();
  }
  
  const users = await req.db.user.findMany();
  res.sendSuccess(users, 'Usu√°rios recuperados');
});
```

## Refer√™ncia da API üìñ

### Interfaces Extens√≠veis

- `RequestServer` - Objeto de requisi√ß√£o HTTP
- `ResponseServer` - Objeto de resposta HTTP
- `AzuraClient` - Classe principal da aplica√ß√£o

### M√©todos de Extens√£o

- `declare module 'azura'` - Module augmentation
- `interface RequestServer extends ...` - Estender request
- `interface ResponseServer extends ...` - Estender response

## Exemplos üìö

Confira exemplos completos:
- [type-extensions.example.ts](https://github.com/0xvin/azurajs/blob/main/examples/servers/type-extensions.example.ts) - Extens√µes TypeScript
- [javascript-extensions.example.js](https://github.com/0xvin/azurajs/blob/main/examples/servers/javascript-extensions.example.js) - Extens√µes JavaScript

## Pr√≥ximos Passos üìñ

<Cards>
  <Card title="TypeScript Support" href="/docs/pt/typescript-support" description="Suporte completo ao TypeScript" />
  <Card title="Middleware" href="/docs/pt/middleware" description="Aprenda sobre middleware" />
  <Card title="Controllers" href="/docs/pt/controllers" description="Organize suas rotas" />
</Cards>
