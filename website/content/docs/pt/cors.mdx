---
title: CORS (Cross-Origin Resource Sharing)
description: Guia completo para configurar e proteger CORS em aplica√ß√µes AzuraJS
icon: Globe
---

# CORS (Cross-Origin Resource Sharing) üåê

Cross-Origin Resource Sharing (CORS) √© um mecanismo de seguran√ßa cr√≠tico que controla quais dom√≠nios podem acessar sua API a partir de navegadores. Entender e configurar corretamente o CORS √© essencial para construir aplica√ß√µes web seguras.

## O que √© CORS? ü§î

CORS √© um mecanismo de seguran√ßa do navegador que restringe p√°ginas web de fazer requisi√ß√µes para um dom√≠nio diferente daquele que serviu a p√°gina. Sem configura√ß√£o CORS adequada, sua API seria completamente inacess√≠vel a aplica√ß√µes frontend hospedadas em dom√≠nios diferentes.

### Por que CORS Existe

**Pol√≠tica de Mesma Origem**: Navegadores aplicam esta pol√≠tica de seguran√ßa por padr√£o para prevenir sites maliciosos de roubar dados sens√≠veis. Por exemplo, sem CORS, um site malicioso poderia fazer requisi√ß√µes √† API do seu banco usando seus cookies de sess√£o existentes.

**Exemplo Real**:
```
Sua API:      https://api.example.com
Seu Frontend: https://app.example.com
Atacante:     https://site-malicioso.com

Sem CORS:
‚úÖ app.example.com ‚Üí api.example.com (Permitido - precisa CORS)
‚ùå site-malicioso.com ‚Üí api.example.com (Bloqueado - prote√ß√£o!)

Com CORS Configurado:
‚úÖ app.example.com ‚Üí api.example.com (Permitido via headers CORS)
‚ùå site-malicioso.com ‚Üí api.example.com (Ainda bloqueado!)
```

### Diagrama do Fluxo CORS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      1. Preflight        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Navegador  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄOPTIONS Request‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ  Servidor API‚îÇ
‚îÇ             ‚îÇ                           ‚îÇ              ‚îÇ
‚îÇ app.example ‚îÇ <‚îÄ‚îÄ‚îÄAccess-Control-*‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ api.example  ‚îÇ
‚îÇ    .com     ‚îÇ    Headers em 204        ‚îÇ    .com      ‚îÇ
‚îÇ             ‚îÇ                           ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ 2. Requisi√ß√£o Real       ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄGET/POST/PUT‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ    + Header Origin        ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ                           ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ <‚îÄ‚îÄ‚îÄResposta com‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ              ‚îÇ
‚îÇ             ‚îÇ    Headers CORS           ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

<Callout type="info">
**Ponto Chave**: CORS √© aplicado pelo **navegador**, n√£o pelo servidor. Ferramentas de linha de comando como `curl` ou Postman n√£o aplicam CORS, por isso APIs funcionam no Postman mas falham no navegador!
</Callout>

## Como CORS Funciona üîÑ

### Requisi√ß√µes Simples

Requisi√ß√µes simples n√£o disparam preflight:
- M√©todos: `GET`, `HEAD`, `POST`
- Headers: `Accept`, `Accept-Language`, `Content-Language`, `Content-Type` (apenas `application/x-www-form-urlencoded`, `multipart/form-data`, `text/plain`)

### Requisi√ß√µes Preflight

Requisi√ß√µes complexas requerem preflight (OPTIONS):
- Headers customizados (ex: `Authorization`, `X-API-Key`)
- M√©todos: `PUT`, `DELETE`, `PATCH`
- Content-Type: `application/json`

## Refer√™ncia de Headers CORS üìã

| Header | Prop√≥sito | Exemplo |
|--------|---------|----------|
| `Access-Control-Allow-Origin` | Origens permitidas | `https://app.example.com` |
| `Access-Control-Allow-Methods` | M√©todos HTTP permitidos | `GET, POST, PUT, DELETE` |
| `Access-Control-Allow-Headers` | Headers de requisi√ß√£o permitidos | `Content-Type, Authorization` |
| `Access-Control-Allow-Credentials` | Permitir cookies/auth | `true` |
| `Access-Control-Expose-Headers` | Headers vis√≠veis ao JS | `X-Total-Count` |
| `Access-Control-Max-Age` | Tempo de cache preflight | `86400` (24 horas) |

## Plugin CORS Embutido üì¶

AzuraJS inclui um plugin CORS pronto para uso:

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: "*",  // Permitir todas as origens
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
      allowedHeaders: ["Content-Type", "Authorization"],
      exposedHeaders: ["X-Total-Count"],
      credentials: true,
      maxAge: 86400  // 24 horas
    }
  }
});
```

## Configura√ß√£o do Plugin CORS ‚öôÔ∏è

### Op√ß√µes Dispon√≠veis

```typescript
interface CORSOptions {
  enabled: boolean;              // Ativar/desativar CORS
  origin: string | string[];     // Origens permitidas
  methods: string[];             // M√©todos HTTP permitidos
  allowedHeaders: string[];      // Cabe√ßalhos permitidos
  exposedHeaders?: string[];     // Cabe√ßalhos expostos ao cliente
  credentials?: boolean;         // Permitir cookies
  maxAge?: number;               // Cache de preflight (segundos)
  preflightContinue?: boolean;   // Passar preflight ao pr√≥ximo handler
}
```

### Exemplo Completo

```typescript
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: ["https://example.com", "https://app.example.com"],
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
      allowedHeaders: [
        "Content-Type",
        "Authorization",
        "X-Requested-With",
        "X-API-Key"
      ],
      exposedHeaders: [
        "X-Total-Count",
        "X-Page-Number",
        "X-Page-Size"
      ],
      credentials: true,
      maxAge: 7200  // 2 horas
    }
  }
});
```

## Origens Din√¢micas üéØ

Use uma fun√ß√£o para determinar origens dinamicamente:

```typescript
// Middleware CORS customizado
function corsMiddleware(req: RequestServer, res: ResponseServer, next: () => void) {
  const origin = req.headers.origin;
  
  // Lista de origens permitidas
  const allowedOrigins = [
    "https://example.com",
    "https://app.example.com",
    /^https:\/\/.*\.example\.com$/  // Subdom√≠nios
  ];
  
  // Verificar se origem √© permitida
  const isAllowed = allowedOrigins.some(allowed => {
    if (typeof allowed === "string") {
      return allowed === origin;
    }
    return allowed.test(origin || "");
  });
  
  if (isAllowed) {
    res.setHeader("Access-Control-Allow-Origin", origin!);
    res.setHeader("Access-Control-Allow-Credentials", "true");
  }
  
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, PATCH");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
  
  // Lidar com preflight
  if (req.method === "OPTIONS") {
    return res.status(204).end();
  }
  
  next();
}

app.use(corsMiddleware);
```

## Middleware CORS Simples üîå

Crie um middleware CORS b√°sico:

```typescript
function simpleCors(req: RequestServer, res: ResponseServer, next: () => void) {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type");
  
  if (req.method === "OPTIONS") {
    return res.status(204).end();
  }
  
  next();
}

app.use(simpleCors);
```

## CORS com Credenciais üîê

Para permitir cookies e autentica√ß√£o:

```typescript
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: "https://app.example.com",  // Origem espec√≠fica (n√£o "*")
      credentials: true,  // Permitir cookies
      allowedHeaders: ["Content-Type", "Authorization"]
    }
  }
});
```

**Importante:** Quando `credentials: true`, `origin` N√ÉO pode ser `"*"`. Voc√™ deve especificar origens exatas.

## Preflight Requests ‚úàÔ∏è

Requisi√ß√µes preflight (OPTIONS) s√£o enviadas pelo navegador antes de requisi√ß√µes complexas:

```typescript
// Lidar com preflight manualmente
@Controller("/api")
export class ApiController {
  @Options("*")
  handlePreflight(@Res() res: ResponseServer) {
    res.setHeader("Access-Control-Allow-Origin", "https://example.com");
    res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
    res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
    res.setHeader("Access-Control-Max-Age", "86400");  // Cache por 24h
    res.status(204).end();
  }
}
```

## CORS por Rota üõ£Ô∏è

Aplique CORS a rotas espec√≠ficas:

```typescript
function corsForRoute(allowedOrigin: string) {
  return (req: RequestServer, res: ResponseServer, next: () => void) => {
    res.setHeader("Access-Control-Allow-Origin", allowedOrigin);
    res.setHeader("Access-Control-Allow-Methods", "GET, POST");
    
    if (req.method === "OPTIONS") {
      return res.status(204).end();
    }
    
    next();
  };
}

// Aplicar apenas a rotas p√∫blicas
app.use("/api/public", corsForRoute("*"));

// Aplicar apenas a rotas do painel
app.use("/api/dashboard", corsForRoute("https://dashboard.example.com"));
```

## Exemplos Pr√°ticos üé®

### API P√∫blica com CORS Aberto

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: "*",
      methods: ["GET"],  // Apenas leitura
      allowedHeaders: ["Content-Type"]
    }
  }
});

@Controller("/api/public")
export class PublicApiController {
  @Get("/data")
  getData() {
    return { data: "p√∫blico" };
  }
}
```

### API Privada com CORS Restrito

```typescript
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: [
        "https://app.example.com",
        "https://admin.example.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE"],
      allowedHeaders: ["Content-Type", "Authorization"],
      credentials: true
    }
  }
});

@Controller("/api/private")
export class PrivateApiController {
  @Get("/user")
  getUser(@Headers("authorization") auth: string) {
    // Verificar token
    return { user: "data" };
  }
}
```

### CORS Condicional

```typescript
function conditionalCors(req: RequestServer, res: ResponseServer, next: () => void) {
  const origin = req.headers.origin;
  const path = req.url;
  
  // Rotas p√∫blicas: CORS aberto
  if (path.startsWith("/api/public")) {
    res.setHeader("Access-Control-Allow-Origin", "*");
  }
  // Rotas privadas: CORS restrito
  else if (path.startsWith("/api/private")) {
    const allowedOrigins = ["https://app.example.com"];
    if (origin && allowedOrigins.includes(origin)) {
      res.setHeader("Access-Control-Allow-Origin", origin);
      res.setHeader("Access-Control-Allow-Credentials", "true");
    }
  }
  
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
  
  if (req.method === "OPTIONS") {
    return res.status(204).end();
  }
  
  next();
}

app.use(conditionalCors);
```

## Depura√ß√£o de CORS üîç

### Logging de CORS

```typescript
function corsDebug(req: RequestServer, res: ResponseServer, next: () => void) {
  const origin = req.headers.origin;
  const method = req.method;
  
  console.log("CORS Request:", { origin, method, path: req.url });
  
  res.setHeader("Access-Control-Allow-Origin", origin || "*");
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
  
  if (method === "OPTIONS") {
    console.log("Preflight request handled");
    return res.status(204).end();
  }
  
  next();
}

app.use(corsDebug);
```

### Cabe√ßalhos de Resposta

Exponha cabe√ßalhos customizados ao frontend:

```typescript
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origin: "*",
      exposedHeaders: [
        "X-Total-Count",      // Total de registros
        "X-Page-Number",      // N√∫mero da p√°gina
        "X-Page-Size",        // Tamanho da p√°gina
        "X-RateLimit-Limit",  // Limite de rate
        "X-RateLimit-Remaining"  // Requisi√ß√µes restantes
      ]
    }
  }
});

@Get("/users")
getUsers(@Query("page") page: string, @Res() res: ResponseServer) {
  const users = getUsersFromDB(page);
  
  // Definir cabe√ßalhos customizados
  res.setHeader("X-Total-Count", "1000");
  res.setHeader("X-Page-Number", page || "1");
  res.setHeader("X-Page-Size", "10");
  
  res.json({ users });
}
```

## Problemas Comuns üö®

### Erro: Credenciais com Origin *

```typescript
// ‚ùå N√£o funciona
{
  origin: "*",
  credentials: true  // Erro!
}

// ‚úÖ Funciona
{
  origin: "https://app.example.com",
  credentials: true
}
```

### Cabe√ßalhos Customizados N√£o Funcionam

```typescript
// Frontend
fetch("https://api.example.com/data", {
  headers: {
    "X-Custom-Header": "value"  // Precisa estar em allowedHeaders
  }
});

// Backend
{
  cors: {
    allowedHeaders: [
      "Content-Type",
      "Authorization",
      "X-Custom-Header"  // Adicionar aqui
    ]
  }
}
```

### Preflight Cache

```typescript
{
  cors: {
    maxAge: 86400  // Cache preflight por 24h (reduz requisi√ß√µes OPTIONS)
  }
}
```

## Testando Configura√ß√£o CORS üß™

### Teste no Console do Navegador

```javascript
// Testar no console do navegador
fetch('https://api.example.com/users', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer SEU_TOKEN'
  },
  credentials: 'include'
})
.then(res => res.json())
.then(data => console.log('Sucesso:', data))
.catch(err => console.error('Erro CORS:', err));
```

### Depurando Problemas de CORS

**Verifique na aba Network do navegador:**
1. Procure requisi√ß√µes falhas com erro CORS
2. Verifique os Headers de Resposta para cabe√ßalhos `Access-Control-*`
3. Confirme que requisi√ß√£o preflight OPTIONS teve sucesso (status 204)
4. Verifique se o header Origin corresponde √†s origens permitidas

### P√°gina HTML de Teste CORS

```html
<!DOCTYPE html>
<html>
<head><title>Teste CORS</title></head>
<body>
  <h1>Testar Configura√ß√£o CORS</h1>
  <button onclick="testarCORS()">Testar Requisi√ß√£o API</button>
  <pre id="resultado"></pre>
  
  <script>
    async function testarCORS() {
      const resultado = document.getElementById('resultado');
      try {
        const response = await fetch('https://api.example.com/test', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ teste: true })
        });
        const data = await response.json();
        resultado.textContent = 'Sucesso: ' + JSON.stringify(data, null, 2);
      } catch (error) {
        resultado.textContent = 'Erro: ' + error.message;
      }
    }
  </script>
</body>
</html>
```

## Configura√ß√£o por Ambiente üèóÔ∏è

### Ambiente de Desenvolvimento

```typescript
const devConfig: ConfigTypes = {
  plugins: {
    cors: {
      enabled: true,
      origins: ["*"],  // Permitir todas durante desenvolvimento
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
      allowedHeaders: ["*"],
      credentials: false
    }
  }
};
```

### Ambiente de Staging

```typescript
const stagingConfig: ConfigTypes = {
  plugins: {
    cors: {
      enabled: true,
      origins: [
        "https://staging.example.com",
        "https://preview.example.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE"],
      allowedHeaders: ["Content-Type", "Authorization"],
      credentials: true,
      maxAge: 3600  // 1 hora
    }
  }
};
```

### Ambiente de Produ√ß√£o

```typescript
const prodConfig: ConfigTypes = {
  plugins: {
    cors: {
      enabled: true,
      origins: [
        "https://example.com",
        "https://www.example.com",
        "https://app.example.com"
      ],
      methods: ["GET", "POST", "PUT", "DELETE"],
      allowedHeaders: ["Content-Type", "Authorization", "X-API-Key"],
      exposedHeaders: ["X-Total-Count", "X-RateLimit-Remaining"],
      credentials: true,
      maxAge: 86400  // 24 horas
    }
  }
};
```

### Configura√ß√£o Baseada em Vari√°veis de Ambiente

```typescript
const getConfig = (): ConfigTypes => {
  const env = process.env.NODE_ENV || 'development';
  
  const corsOrigins = {
    development: ["*"],
    staging: ["https://staging.example.com"],
    production: ["https://example.com", "https://app.example.com"]
  };
  
  return {
    plugins: {
      cors: {
        enabled: true,
        origins: corsOrigins[env],
        methods: ["GET", "POST", "PUT", "DELETE"],
        allowedHeaders: ["Content-Type", "Authorization"],
        credentials: env !== 'development',
        maxAge: env === 'production' ? 86400 : 3600
      }
    }
  };
};

export default getConfig();
```

## Otimiza√ß√£o de Performance ‚ö°

### Cache de Requisi√ß√µes Preflight

```typescript
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origins: ["https://app.example.com"],
      maxAge: 86400  // Cache por 24 horas = 99% menos requisi√ß√µes OPTIONS
    }
  }
});
```

**Benef√≠cios:**
- Reduz significativamente a carga do servidor
- Requisi√ß√µes subsequentes mais r√°pidas
- Melhor experi√™ncia do usu√°rio

**Considera√ß√µes:**
- Mudan√ßas na config CORS requerem expira√ß√£o do cache
- Use `maxAge` menor durante desenvolvimento (600 = 10 minutos)

## Melhores Pr√°ticas ‚ú®

<Callout type="tip">
  **Seja espec√≠fico com origens**: Evite `"*"` em produ√ß√£o
</Callout>

<Callout type="tip">
  **Use HTTPS em produ√ß√£o**: CORS com credentials requer HTTPS
</Callout>

<Callout type="tip">
  **Cache preflight requests**: Use maxAge para reduzir requisi√ß√µes OPTIONS
</Callout>

<Callout type="warn">
  **N√£o exponha cabe√ßalhos sens√≠veis**: Apenas exponha o necess√°rio
</Callout>

## Solu√ß√£o de Problemas CORS üîß

### Erro: "No 'Access-Control-Allow-Origin' header"

**Problema**: Servidor n√£o envia headers CORS

```typescript
// ‚ùå Ruim - CORS n√£o configurado
const app = new AzuraClient();

// ‚úÖ Bom - CORS configurado
const app = new AzuraClient({
  plugins: {
    cors: {
      enabled: true,
      origins: ["https://app.example.com"]
    }
  }
});
```

### Erro: "Credential is not supported if origin is '*'"

**Problema**: Usando wildcard com credentials

```typescript
// ‚ùå Ruim
cors: {
  origins: ["*"],
  credentials: true  // Erro!
}

// ‚úÖ Bom
cors: {
  origins: ["https://app.example.com"],
  credentials: true
}
```

### Erro: "Header 'X-Custom-Header' not allowed"

**Problema**: Header customizado n√£o est√° na lista permitida

```typescript
// ‚ùå Ruim - header n√£o permitido
cors: {
  allowedHeaders: ["Content-Type"]
}

// ‚úÖ Bom - incluir header customizado
cors: {
  allowedHeaders: ["Content-Type", "X-Custom-Header", "Authorization"]
}
```

### Erro: "Method PUT not allowed"

**Problema**: M√©todo HTTP n√£o est√° na lista permitida

```typescript
// ‚ùå Ruim - PUT n√£o permitido
cors: {
  methods: ["GET", "POST"]
}

// ‚úÖ Bom - incluir todos os m√©todos necess√°rios
cors: {
  methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
}
```

### Problemas de Cache Preflight

**Problema**: Navegador cacheia configura√ß√£o CORS antiga

```typescript
// Adicionar max-age para controlar cache
cors: {
  maxAge: 86400  // Cache por 24 horas
}

// Para debugar: Limpe o cache do navegador ou use modo an√¥nimo
```

### Depurando Middleware CORS

```typescript
import type { RequestHandler } from "azurajs/types";

export const debugCorsMiddleware: RequestHandler = async (req, res, next) => {
  console.log("CORS Debug:", {
    method: req.method,
    origin: req.headers.origin,
    path: req.url,
    headers: req.headers
  });
  
  const origin = req.headers.origin || "*";
  res.setHeader("Access-Control-Allow-Origin", origin);
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
  res.setHeader("Access-Control-Allow-Credentials", "true");
  
  if (req.method === "OPTIONS") {
    console.log("Preflight request handled");
    res.status(204).end();
    return;
  }
  
  await next();
};
```

## Melhores Pr√°ticas de Seguran√ßa üîí

<Callout type="warn">
**Nunca use "*" em produ√ß√£o com dados sens√≠veis** - Sempre especifique origens exatas
</Callout>

<Callout type="warn">
**N√£o use "*" com credentials** - Navegadores rejeitar√£o a requisi√ß√£o
</Callout>

<Callout type="tip">
**Use HTTPS em produ√ß√£o** - CORS com credentials requer conex√µes seguras
</Callout>

<Callout type="tip">
**Whitelist apenas headers necess√°rios** - N√£o exponha headers internos
</Callout>

<Callout type="tip">
**Cache preflight requests** - Use `maxAge` para reduzir requisi√ß√µes OPTIONS
</Callout>

<Callout type="info">
**Log viola√ß√µes CORS** - Monitore requisi√ß√µes bloqueadas para detectar problemas
</Callout>

### Checklist de Seguran√ßa ‚úÖ

```typescript
// Configura√ß√£o CORS pronta para produ√ß√£o
const productionCors = {
  // ‚úÖ Apenas origens espec√≠ficas
  origins: [
    "https://example.com",
    "https://www.example.com",
    "https://app.example.com"
  ],
  
  // ‚úÖ Apenas m√©todos necess√°rios
  methods: ["GET", "POST", "PUT", "DELETE"],
  
  // ‚úÖ Apenas headers obrigat√≥rios
  allowedHeaders: ["Content-Type", "Authorization"],
  
  // ‚úÖ N√£o exponha headers sens√≠veis
  exposedHeaders: ["X-Total-Count"],
  
  // ‚úÖ Habilitar credentials se necess√°rio
  credentials: true,
  
  // ‚úÖ Cache preflight por 24 horas
  maxAge: 86400
};
```

## Checklist de Produ√ß√£o üìã

- [ ] Remover "*" das origens
- [ ] Usar HTTPS para todas as origens
- [ ] Habilitar credentials apenas se necess√°rio
- [ ] Whitelist apenas headers necess√°rios
- [ ] Definir maxAge apropriado para cache preflight
- [ ] Logar erros CORS para monitoramento
- [ ] Testar com aplica√ß√£o frontend real
- [ ] Verificar manipula√ß√£o de cookie/sess√£o
- [ ] Verificar suporte a subdom√≠nios se necess√°rio
- [ ] Configurar CORS diferente para rotas diferentes
- [ ] Testar requisi√ß√µes preflight OPTIONS
- [ ] Verificar se headers expostos s√£o acess√≠veis

## Padr√µes Avan√ßados üöÄ

### Configura√ß√£o CORS por Rota

```typescript
import { AzuraClient } from "azurajs";
import type { RequestHandler } from "azurajs/types";

const app = new AzuraClient();

// API P√∫blica - CORS aberto
const publicCors: RequestHandler = async (req, res, next) => {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader("Access-Control-Allow-Methods", "GET");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type");
  
  if (req.method === "OPTIONS") {
    res.status(204).end();
    return;
  }
  
  await next();
};

// API Privada - CORS restrito
const privateCors: RequestHandler = async (req, res, next) => {
  const origin = req.headers.origin;
  const allowedOrigins = ["https://app.example.com", "https://admin.example.com"];
  
  if (origin && allowedOrigins.includes(origin)) {
    res.setHeader("Access-Control-Allow-Origin", origin);
    res.setHeader("Access-Control-Allow-Credentials", "true");
  }
  
  res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
  res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
  
  if (req.method === "OPTIONS") {
    res.status(204).end();
    return;
  }
  
  await next();
};

app.use("/api/public", publicCors);
app.use("/api/private", privateCors);
```

### CORS com N√≠veis de Autentica√ß√£o

```typescript
function createAuthenticatedCors(allowedOrigins: string[]): RequestHandler {
  return async (req, res, next) => {
    const origin = req.headers.origin;
    const token = req.headers.authorization;
    
    // Verificar autentica√ß√£o
    if (!token) {
      res.status(401).json({ error: "Autentica√ß√£o necess√°ria" });
      return;
    }
    
    // Verificar token e origem
    if (origin && allowedOrigins.includes(origin)) {
      res.setHeader("Access-Control-Allow-Origin", origin);
      res.setHeader("Access-Control-Allow-Credentials", "true");
    } else {
      res.status(403).json({ error: "Origem n√£o permitida" });
      return;
    }
    
    res.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
    res.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
    
    if (req.method === "OPTIONS") {
      res.status(204).end();
      return;
    }
    
    await next();
  };
}
```

## Pr√≥ximos Passos üìö

<Cards>
  <Card title="Rate Limiting" href="/docs/rate-limiting" description="Proteja sua API de abuso" />
  <Card title="Tratamento de Erros" href="/docs/error-handling" description="Trate erros graciosamente" />
  <Card title="Middleware" href="/docs/middleware" description="Crie middleware customizado" />
  <Card title="Seguran√ßa" href="/docs/security" description="Melhores pr√°ticas de seguran√ßa" />
</Cards>
